import ae from"cross-fetch";var d={MAYAN_FORWARDER_CONTRACT:"0x337685fdaB40D39bd02028545a4FfA7D287cC3E2",MAYAN_PROGRAM_ID:"FC4eXxkyrMPTjiYUpp4EAnkmwMbQyZ6NDCh1kfLn6vsf",AUCTION_PROGRAM_ID:"8QJmxZcEzwuYmCPy6XqgN2sHcYCcFq6AEfBMJZZuLo5a",MCTP_PROGRAM_ID:"dkpZqrxHFrhziEMQ931GLtfy11nFkCsfMftH9u6QwBU",SWIFT_PROGRAM_ID:"BLZRi6frs4X4DNLw56V4EXai1b6QVESN1BhHBTYM9VcY",FEE_MANAGER_PROGRAM_ID:"5VtQHnhs2pfVEr68qQsbTRwKh4JV5GTu9mBHgHFxpHeQ",WORMHOLE_PROGRAM_ID:"worm2ZoG2kUd4vFXhvjh93UUH596ayRfgQ2MgjNMTth",CCTP_CORE_PROGRAM_ID:"CCTPmbSD7gX1bxKPAmg77w8oFzNFpaQiQUWD43TKaecd",CCTP_TOKEN_PROGRAM_ID:"CCTPiPYPc6AsJuwueEnWgSgucamXDZwBd53dQ11YiKX3",TOKEN_PROGRAM_ID:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",TOKEN_2022_PROGRAM_ID:"TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb",ASSOCIATED_TOKEN_PROGRAM_ID:"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",SPL_UTILS_PROGRAM_ID:"B96dV3Luxzo6SokJx3xt8i5y8Mb7HRR6Eec8hCjJDT69",LOOKUP_TABLE:"75X8YgJPcadksw6Ag3qsYUfi1bsFwDoCKYtqPPqdydAG",SUI_MCTP_STATE:"0xb787fe0f7530b4fd2162fa0cc92f4f6c5a97c54b4c5c55eb04ab29f4b803ac9c",SUI_MCTP_FEE_MANAGER_STATE:"0xa1b4a96ce93d36dd0bbce0adc39533a07d2f32928918c80cd6fe7868320978f2",SUI_CCTP_CORE_PACKAGE_ID:"0x08d87d37ba49e785dde270a83f8e979605b03dc552b5548f26fdf2f49bf7ed1b",SUI_CCTP_CORE_STATE:"0xf68268c3d9b1df3215f2439400c1c4ea08ac4ef4bb7d6f3ca6a2a239e17510af",SUI_CCTP_TOKEN_PACKAGE_ID:"0x2aa6c5d56376c371f88a6cc42e852824994993cb9bab8d3e6450cbe3cb32b94e",SUI_CCTP_TOKEN_STATE:"0x45993eecc0382f37419864992c12faee2238f5cfe22b98ad3bf455baf65c8a2f",SUI_WORMHOLE_PACKAGE_ID:"0x5306f64e312b581766351c07af79c72fcb1cd25147157fdc2f8ad76de9a3fb6a",SUI_WORMHOLE_STATE:"0xaeab97f96cf9877fee2883315d459552b2b921edc16d7ceac6eab944dd88919c",SUI_LOGGER_PACKAGE_ID:"0x05680e9030c147b413a489f7891273acc221d49bd061c433e5771bc170fc37ac",EXPLORER_URL:"https://explorer-api.mayan.finance/v3",PRICE_URL:"https://price-api.mayan.finance/v3",RELAYER_URL:"https://relayer-api.mayan.finance/v3"};import{zeroPadValue as et,parseUnits as na,formatUnits as aa}from"ethers";import{PublicKey as Se,SystemProgram as Mt}from"@solana/web3.js";import{Buffer as nt}from"buffer";import*as _t from"js-sha3";var ra=_t.sha3_256,ia=e=>/^(0x)?[0-9a-fA-F]+::\w+::\w+$/.test(e);function A(e,t){if(t===1)return et(new Se(e).toBytes(),32);if(t===G.ethereum||t===G.bsc||t===G.polygon||t===G.avalanche||t===G.arbitrum||t===G.optimism||t===G.base||t===G.unichain||t===G.linea)return et(e,32);if(t===G.aptos&&ia(e))return`0x${ra(e)}`;if(t===G.sui){let a=e.startsWith("0x")?e.substring(2):e;if(nt.from(a,"hex").length!==32)throw new Error("Invalid sui address: "+e);return et(e,32)}else throw console.log(`Unsupported chain id: ${t}`,e),new Error("Unsupported token chain")}function K(e){return new Uint8Array(nt.from(e.startsWith("0x")?e.substring(2):e,"hex"))}function F(e,t,a=!1,r=new Se(d.TOKEN_PROGRAM_ID),i=new Se(d.ASSOCIATED_TOKEN_PROGRAM_ID)){if(!a&&!Se.isOnCurve(t.toBuffer()))throw new Error("TokenOwnerOffCurveError");let[u]=Se.findProgramAddressSync([t.toBuffer(),r.toBuffer(),e.toBuffer()],i);return u}function g(e,t){if(e==null)throw new Error("getAmountOfFractionalAmount: Amount is null or undefined");if(typeof e!="string"&&typeof e!="number")throw new Error("getAmountOfFractionalAmount: Amount is not a string or number");if(typeof e=="string"&&e.length===0)throw new Error("getAmountOfFractionalAmount: Amount is empty");if(!Number.isFinite(Number(e)))throw new Error("getAmountOfFractionalAmount: Amount is not a number");let a=Math.min(8,Number(t)),r=Number(e).toFixed(a+1),i=new RegExp(`^-?\\d+(?:\\.\\d{0,${a}})?`),u=r.match(i);if(!u)throw new Error("getAmountOfFractionalAmount: fixedAmount is null");let s=u[0];return na(s,Number(t))}function or(e,t){return Number(aa(e,t))}var G={solana:1,ethereum:2,bsc:4,polygon:5,avalanche:6,arbitrum:23,optimism:24,base:30,aptos:22,sui:21,unichain:44,linea:38};function S(e){return G[e]}var tt={[1]:2,[56]:4,[137]:5,[43114]:6,[42161]:23,[10]:24,[8453]:30,[130]:44,[59144]:38};function Pt(e){let t=G[e],a=Object.keys(tt);for(let r of a)if(tt[r]===t)return Number(r);throw new Error(`Unsupported chain: ${e}`)}function H(e){return tt[e]}var ge=[10,5,0];function Oe(){return ge.join("_")}function kt(e){return ge[0]<e[0]?!1:ge[0]>e[0]?!0:ge[1]<e[1]?!1:ge[1]>e[1]||ge[2]>=e[2]}function D(e){return e==="solana"?9:18}function Et(e){return e==="solana"?9:8}var sa=BigInt(2)**BigInt(64)-BigInt(1);function R(e){if(e<BigInt(0)||e>sa)throw new Error(`Invalid u64: ${e}`);let t=nt.alloc(8);return t.writeBigUInt64LE(e),t}var q={value:BigInt(0),deadline:0,v:0,r:`0x${Mt.programId.toBuffer().toString("hex")}`,s:`0x${Mt.programId.toBuffer().toString("hex")}`};function Fe(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}function fe(e,t){return!e||!t?null:e.type==="WH"?t?.solana||null:e.type==="MCTP"||e.type==="SWIFT"?e.toChain==="solana"?t?.solana||null:e.toChain==="sui"?t?.sui||null:t?.evm||null:null}var De=1,ve=2,Rt=1,Ot=1,Ft=2,Dt=3;function at(e){return Object.entries(e).filter(([t,a])=>a!=null&&!Array.isArray(a)).map(([t,a])=>`${encodeURIComponent(t)}=${encodeURIComponent(a)}`).join("&")}async function re(e){if(e.status.toString().startsWith("5")){let t;try{let a=await e.json();(a?.code||a?.statusCode)&&(a?.message||a?.msg)&&(t={code:a?.code||a?.statusCode,message:a?.message||a?.msg})}catch{t=new Error("Internal server error")}throw t}}async function dr(e){let t=e?`?standard=${e.join(",")}`:"",a=await ae(`${d.PRICE_URL}/tokens${t}`,{method:"GET",redirect:"follow"});if(await re(a),a.status===200)return await a.json();throw new Error("Cannot fetch Mayan tokens!")}async function mr(e,t=!1,a){let r={chain:e,nonPortal:t,standard:a?a?.join(","):void 0},i=await ae(`${d.PRICE_URL}/tokens?${at(r)}`);if(await re(i),i.status===200)return(await i.json())[e];throw new Error("Cannot fetch Mayan tokens!")}function oa(e,t={wormhole:!0,swift:!0,mctp:!0,shuttle:!0,gasless:!1,onlyDirect:!1,fastMctp:!0}){let{gasDrop:a,referrerBps:r}=e,i=e.slippageBps;i!=="auto"&&!Number.isFinite(i)&&(i=e.slippage*100);let s={...{wormhole:t.wormhole!==!1,swift:t.swift!==!1,mctp:t.mctp!==!1,shuttle:t.shuttle===!0,fastMctp:t.fastMctp!==!1,gasless:t.gasless===!0,onlyDirect:t.onlyDirect===!0},solanaProgram:d.MAYAN_PROGRAM_ID,forwarderAddress:d.MAYAN_FORWARDER_CONTRACT,amountIn:!e.amountIn64&&Number.isFinite(e.amount)?e.amount:void 0,amountIn64:e.amountIn64,fromToken:e.fromToken,fromChain:e.fromChain,toToken:e.toToken,toChain:e.toChain,slippageBps:i,referrer:e.referrer,referrerBps:Number.isFinite(r)?r:void 0,gasDrop:Number.isFinite(a)?a:void 0,sdkVersion:Oe()},n=`${d.PRICE_URL}/quote?`,p=at(s);return n+p}async function yr(e,t={swift:!0,mctp:!0,gasless:!1,onlyDirect:!1}){let a=oa(e,t),r=await ae(a,{method:"GET",redirect:"follow"});await re(r);let i=await r.json();if(r.status!==200&&r.status!==201)throw{code:i?.code||0,message:i?.msg||i?.message||"Route not found",data:i?.data};if(!kt(i.minimumSdkVersion))throw{code:9999,message:"Swap SDK is outdated!"};return i.quotes}async function fr(e){let t=await ae(`${d.PRICE_URL}/clock/${e}`,{method:"GET",redirect:"follow"});await re(t);let a=await t.json();if(t.status!==200&&t.status!==201)throw a;return a.clock}async function vt(){let e=await ae(`${d.RELAYER_URL}/active-relayers?solanaProgram=${d.MAYAN_PROGRAM_ID}`,{method:"GET",redirect:"follow"});await re(e);let t=await e.json();if(e.status!==200&&e.status!==201)throw t;return t.suggested}async function xe(e){let t=at({...e,sdkVersion:Oe()}),a=await ae(`${d.PRICE_URL}/get-swap/solana?${t}`,{method:"GET",redirect:"follow"});await re(a);let r=await a.json();if(a.status!==200&&a.status!==201)throw r;return r}async function xt(e){let t=JSON.stringify({...e,sdkVersion:Oe()}),a=`${d.PRICE_URL}/get-swap/sui`,r=await ae(a,{method:"POST",redirect:"follow",body:t,headers:{"Content-Type":"application/json"}});await re(r);let i=await r.json();if(r.status!==200&&r.status!==201)throw i;return i}async function Bt(e,t){let a=await ae(`${d.EXPLORER_URL}/submit/evm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,signature:t},(r,i)=>typeof i=="bigint"?i.toString():i)});await re(a)}async function Nt(e){let t=await ae(`${d.EXPLORER_URL}/submit/solana`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedTx:e})});await re(t);let a=await t.json();if(t.status!==200&&t.status!==201)throw a;return a}import{Contract as Nn,toBeHex as Wn,ZeroAddress as Ln}from"ethers";import{PublicKey as wt,SystemProgram as Ya}from"@solana/web3.js";var Wt={_format:"hh-sol-artifact-1",contractName:"MayanSwap",sourceName:"src/MayanSwap.sol",abi:[{inputs:[{internalType:"address",name:"_tokenBridge",type:"address"},{internalType:"address",name:"_weth",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint16",name:"emitterChainId",type:"uint16"},{indexed:!0,internalType:"bytes32",name:"emitterAddress",type:"bytes32"},{indexed:!0,internalType:"uint64",name:"sequence",type:"uint64"}],name:"Redeemed",type:"event"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"bytes32",name:"tokenAddr",type:"bytes32"},{internalType:"uint16",name:"tokenChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"sourceAddr",type:"bytes32"},{internalType:"uint16",name:"sourceChainId",type:"uint16"},{internalType:"uint64",name:"sequence",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bool",name:"unwrapRedeem",type:"bool"},{internalType:"bool",name:"unwrapRefund",type:"bool"}],internalType:"struct MayanStructs.Swap",name:"s",type:"tuple"}],name:"encodeSwap",outputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],stateMutability:"pure",type:"function"},{inputs:[],name:"getWeth",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isPaused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseRedeemPayload",outputs:[{components:[{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"bytes32",name:"recipient",type:"bytes32"},{internalType:"uint64",name:"relayerFee",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanStructs.Redeem",name:"r",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeem",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeemAndUnwrap",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwap.RelayerFees",name:"relayerFees",type:"tuple"},{components:[{internalType:"bytes32",name:"mayanAddr",type:"bytes32"},{internalType:"uint16",name:"mayanChainId",type:"uint16"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrer",type:"bytes32"},{internalType:"bytes32",name:"refundAddr",type:"bytes32"}],internalType:"struct MayanSwap.Recepient",name:"recipient",type:"tuple"},{internalType:"bytes32",name:"tokenOutAddr",type:"bytes32"},{internalType:"uint16",name:"tokenOutChainId",type:"uint16"},{components:[{internalType:"uint256",name:"transferDeadline",type:"uint256"},{internalType:"uint64",name:"swapDeadline",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanSwap.Criteria",name:"criteria",type:"tuple"},{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"}],name:"swap",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"sweepEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"sweepToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwap.RelayerFees",name:"relayerFees",type:"tuple"},{components:[{internalType:"bytes32",name:"mayanAddr",type:"bytes32"},{internalType:"uint16",name:"mayanChainId",type:"uint16"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrer",type:"bytes32"},{internalType:"bytes32",name:"refundAddr",type:"bytes32"}],internalType:"struct MayanSwap.Recepient",name:"recipient",type:"tuple"},{internalType:"bytes32",name:"tokenOutAddr",type:"bytes32"},{internalType:"uint16",name:"tokenOutChainId",type:"uint16"},{components:[{internalType:"uint256",name:"transferDeadline",type:"uint256"},{internalType:"uint64",name:"swapDeadline",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanSwap.Criteria",name:"criteria",type:"tuple"}],name:"wrapAndSwapETH",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}]};var ee={_format:"hh-sol-artifact-1",contractName:"MayanForwarder",sourceName:"src/MayanForwarder.sol",abi:[{inputs:[{internalType:"address",name:"_guardian",type:"address"},{internalType:"address[]",name:"_swapProtocols",type:"address[]"},{internalType:"address[]",name:"_mayanProtocols",type:"address[]"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"UnsupportedProtocol",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"token",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"protocolData",type:"bytes"}],name:"ForwardedERC20",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"protocolData",type:"bytes"}],name:"ForwardedEth",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"SwapAndForwarded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"tokenIn",type:"address"},{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"address",name:"swapProtocol",type:"address"},{indexed:!1,internalType:"address",name:"middleToken",type:"address"},{indexed:!1,internalType:"uint256",name:"middleAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"mayanData",type:"bytes"}],name:"SwapAndForwardedERC20",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"address",name:"swapProtocol",type:"address"},{indexed:!1,internalType:"address",name:"middleToken",type:"address"},{indexed:!1,internalType:"uint256",name:"middleAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"mayanData",type:"bytes"}],name:"SwapAndForwardedEth",type:"event"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct MayanForwarder.PermitParams",name:"permitParams",type:"tuple"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"protocolData",type:"bytes"}],name:"forwardERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"protocolData",type:"bytes"}],name:"forwardEth",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"mayanProtocols",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextGuardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"rescueEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"rescueToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bool",name:"enabled",type:"bool"}],name:"setMayanProtocol",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bool",name:"enabled",type:"bool"}],name:"setSwapProtocol",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct MayanForwarder.PermitParams",name:"permitParams",type:"tuple"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"},{internalType:"address",name:"middleToken",type:"address"},{internalType:"uint256",name:"minMiddleAmount",type:"uint256"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"mayanData",type:"bytes"}],name:"swapAndForwardERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"},{internalType:"address",name:"middleToken",type:"address"},{internalType:"uint256",name:"minMiddleAmount",type:"uint256"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"mayanData",type:"bytes"}],name:"swapAndForwardEth",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"swapProtocols",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],linkReferences:{},deployedLinkReferences:{}};import{Buffer as Kn}from"buffer";import{Contract as st,toBeHex as J,ZeroAddress as it}from"ethers";import{SystemProgram as Kt}from"@solana/web3.js";var rt={_format:"hh-sol-artifact-1",contractName:"MayanCircle",sourceName:"src/MayanCircle.sol",abi:[{inputs:[{internalType:"address",name:"_cctpTokenMessenger",type:"address"},{internalType:"address",name:"_wormhole",type:"address"},{internalType:"address",name:"_feeManager",type:"address"},{internalType:"uint16",name:"_auctionChainId",type:"uint16"},{internalType:"bytes32",name:"_auctionAddr",type:"bytes32"},{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"CallerAlreadySet",type:"error"},{inputs:[],name:"CallerNotSet",type:"error"},{inputs:[],name:"CctpReceiveFailed",type:"error"},{inputs:[],name:"DeadlineViolation",type:"error"},{inputs:[],name:"DomainAlreadySet",type:"error"},{inputs:[],name:"DomainNotSet",type:"error"},{inputs:[],name:"EmitterAlreadySet",type:"error"},{inputs:[],name:"EthTransferFailed",type:"error"},{inputs:[],name:"InvalidAction",type:"error"},{inputs:[],name:"InvalidAddress",type:"error"},{inputs:[],name:"InvalidAmountOut",type:"error"},{inputs:[],name:"InvalidCaller",type:"error"},{inputs:[],name:"InvalidDestAddr",type:"error"},{inputs:[],name:"InvalidDomain",type:"error"},{inputs:[],name:"InvalidEmitter",type:"error"},{inputs:[],name:"InvalidGasDrop",type:"error"},{inputs:[],name:"InvalidMintRecipient",type:"error"},{inputs:[],name:"InvalidNonce",type:"error"},{inputs:[],name:"InvalidOrder",type:"error"},{inputs:[],name:"InvalidPayload",type:"error"},{inputs:[],name:"InvalidProtocolFee",type:"error"},{inputs:[],name:"InvalidRedeemFee",type:"error"},{inputs:[],name:"InvalidReferrerFee",type:"error"},{inputs:[],name:"MintRecipientAlreadySet",type:"error"},{inputs:[],name:"MintRecipientNotSet",type:"error"},{inputs:[],name:"Paused",type:"error"},{inputs:[],name:"Unauthorized",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint32",name:"sourceDomain",type:"uint32"},{indexed:!1,internalType:"uint64",name:"sourceNonce",type:"uint64"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"OrderFulfilled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint32",name:"sourceDomain",type:"uint32"},{indexed:!1,internalType:"uint64",name:"sourceNonce",type:"uint64"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"OrderRefunded",type:"event"},{inputs:[],name:"auctionAddr",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"auctionChainId",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"bytes",name:"customPayload",type:"bytes"}],name:"bridgeWithFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint256",name:"redeemFee",type:"uint256"},{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"}],name:"bridgeWithLockedFee",outputs:[{internalType:"uint64",name:"cctpNonce",type:"uint64"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"cctpTokenMessenger",outputs:[{internalType:"contract ITokenMessenger",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint16",name:"",type:"uint16"}],name:"chainIdToEmitter",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"consistencyLevel",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChain",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"}],internalType:"struct MayanCircle.OrderParams",name:"params",type:"tuple"}],name:"createOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint32",name:"",type:"uint32"}],name:"domainToCaller",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"feeManager",outputs:[{internalType:"contract IFeeManager",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64",name:"",type:"uint64"}],name:"feeStorage",outputs:[{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"redeemFee",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"promisedAmount",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"bytes32",name:"driver",type:"bytes32"}],internalType:"struct MayanCircle.FulfillParams",name:"params",type:"tuple"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"}],name:"fulfillOrder",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"}],name:"getDomain",outputs:[{internalType:"uint32",name:"domain",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isPaused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"keyToMintRecipient",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"localDomain",outputs:[{internalType:"uint32",name:"",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"burnAmount",type:"uint64"},{internalType:"bytes32",name:"burnToken",type:"bytes32"},{internalType:"bytes32",name:"customPayload",type:"bytes32"}],internalType:"struct MayanCircle.BridgeWithFeeParams",name:"bridgeParams",type:"tuple"}],name:"redeemWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"}],name:"redeemWithLockedFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint32",name:"cctpNonce",type:"uint32"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"}],name:"refineFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChain",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"}],internalType:"struct MayanCircle.OrderParams",name:"orderParams",type:"tuple"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"uint16",name:"sourceChainId",type:"uint16"},{internalType:"uint8",name:"protocolBps",type:"uint8"}],internalType:"struct MayanCircle.ExtraParams",name:"extraParams",type:"tuple"}],name:"refund",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"rescueEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"rescueToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],name:"setConsistencyLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"uint32",name:"domain",type:"uint32"}],name:"setDomain",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"domain",type:"uint32"},{internalType:"bytes32",name:"caller",type:"bytes32"}],name:"setDomainCaller",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint16",name:"chainId",type:"uint16"},{internalType:"bytes32",name:"emitter",type:"bytes32"}],name:"setEmitter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_feeManager",type:"address"}],name:"setFeeManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"address",name:"tokenIn",type:"address"},{internalType:"bytes32",name:"mintRecipient",type:"bytes32"}],name:"setMintRecipient",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"}],internalType:"struct MayanCircle.UnlockFeeMsg",name:"unlockMsg",type:"tuple"}],name:"unlockFee",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm1",type:"bytes"},{internalType:"bytes",name:"encodedVm2",type:"bytes"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"}],internalType:"struct MayanCircle.UnlockFeeMsg",name:"unlockMsg",type:"tuple"},{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadType",type:"uint8"},{internalType:"uint64",name:"cctpNonce",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"}],internalType:"struct MayanCircle.UnlockRefinedFeeMsg",name:"refinedMsg",type:"tuple"}],name:"unlockFeeRefined",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wormhole",outputs:[{internalType:"contract IWormhole",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],linkReferences:{},deployedLinkReferences:{}};import{Buffer as ua}from"buffer";import{PublicKey as te}from"@solana/web3.js";import{Buffer as ie}from"buffer";var B=6;function ne(e){switch(e){case"ethereum":return 0;case"avalanche":return 1;case"optimism":return 2;case"arbitrum":return 3;case"solana":return 5;case"base":return 6;case"polygon":return 7;case"sui":return 8;case"unichain":return 10;case"linea":return 11;default:throw new Error("unsupported chain for cctp")}}function Be(e,t){let a=new te(d.CCTP_CORE_PROGRAM_ID),r=new te(d.CCTP_TOKEN_PROGRAM_ID),[i]=te.findProgramAddressSync([ie.from("message_transmitter")],a),[u]=te.findProgramAddressSync([ie.from("sender_authority")],r),[s]=te.findProgramAddressSync([ie.from("local_token"),e.toBytes()],r),[n]=te.findProgramAddressSync([ie.from("token_messenger")],r),[p]=te.findProgramAddressSync([ie.from("token_minter")],r),o=ne(t),[c]=te.findProgramAddressSync([ie.from("remote_token_messenger"),ie.from(o.toString())],r),[l]=te.findProgramAddressSync([ie.from("__event_authority")],a),[m]=te.findProgramAddressSync([ie.from("__event_authority")],r);return{messageTransmitter:i,senderAuthority:u,remoteTokenMessengerKey:c,tokenMessenger:n,tokenMinter:p,eventAuthToken:m,eventAuthCore:l,localToken:s}}function pa(e,t,a,r){let i=H(Number(a)),u=S(e.fromChain),s=S(e.toChain);if(u!==i)throw new Error(`Signer chain id(${Number(a)}) and quote from chain are not same! ${u} !== ${i}`);let n=e.cheaperChain===e.fromChain;if(n&&r)throw new Error("Bridge lock fee cannot have custom payload");let p=A(t,s),o=g(e.redeemRelayerFee,B),c=g(e.gasDrop,Math.min(D(e.toChain),8)),l=BigInt(e.effectiveAmountIn64),m=ne(e.toChain);if(!e.mctpMayanContract)throw new Error("MCTP contract address is missing");let y=e.mctpMayanContract;if(e.toChain==="solana"&&n)throw new Error("Cannot lock fee for transfer to solana");let f=g(e.bridgeFee,D(e.fromChain));return n&&(f=BigInt(0)),{lockFee:n,tokenIn:e.mctpInputContract,amountIn:l,redeemFee:o,gasDrop:c,destAddr:p,destDomain:m,payloadType:r?ve:De,customPayload:r?`0x${ua.from(r).toString("hex")}`:"0x",bridgeFee:f,contractAddress:y}}function Lt(e,t,a,r){let i=pa(e,t,a,r),{contractAddress:u,tokenIn:s,amountIn:n,destAddr:p,lockFee:o,redeemFee:c,gasDrop:l,destDomain:m,customPayload:y,payloadType:f,bridgeFee:b}=i,T=new st(u,rt.abi),I,w;return o?I=T.interface.encodeFunctionData("bridgeWithLockedFee",[s,n,l,c,m,p]):I=T.interface.encodeFunctionData("bridgeWithFee",[s,n,c,l,p,m,f,y]),w=J(b),{to:u,data:I,value:w,_params:i}}function ca(e,t,a,r){let i=H(Number(r)),u=S(e.fromChain),s=S(e.toChain);if(u!==i)throw new Error(`Signer chain id(${Number(r)}) and quote from chain are not same! ${u} !== ${i}`);if(!e.mctpMayanContract)throw new Error("MCTP contract address is missing");let n=e.mctpMayanContract,p=A(t,s),o;a?o=A(a,s):o=A(Kt.programId.toString(),S("solana"));let c=g(e.redeemRelayerFee,B),l=g(e.gasDrop,Math.min(D(e.toChain),8)),m=BigInt(e.effectiveAmountIn64),y=g(e.minAmountOut,Math.min(8,e.toToken.decimals)),f=BigInt(e.deadline64),b=e.toToken.contract===it?A(Kt.programId.toString(),S("solana")):A(e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract,e.toToken.wChainId);return{params:{tokenIn:e.mctpInputContract,amountIn:m,gasDrop:l,destAddr:p,destChain:s,tokenOut:b,minAmountOut:y,deadline:f,redeemFee:c,referrerAddr:o,referrerBps:e.referrerBps||0},bridgeFee:g(e.bridgeFee,D(e.fromChain)),contractAddress:n}}function Ut(e,t,a,r){let i=ca(e,t,a,r),{contractAddress:u,params:s,bridgeFee:n}=i,o=new st(u,rt.abi).interface.encodeFunctionData("createOrder",[s]),c=J(n);return{to:u,data:o,value:c,_params:i}}function Gt(e,t,a,r,i,u){if(e.type!=="MCTP")throw new Error("Quote type is not MCTP");if(!Number.isFinite(Number(r)))throw new Error("Invalid signer chain id");r=Number(r);let s=i||q,n=new st(d.MAYAN_FORWARDER_CONTRACT,ee.abi),p=g(e.bridgeFee,D(e.fromChain)),o=J(p);if(e.fromToken.contract===e.mctpInputContract)if(e.hasAuction){if(!Number(e.deadline64))throw new Error("MCTP order requires timeout");let c=Ut(e,t,a,r),l="forwardERC20",m=[e.fromToken.contract,c._params.params.amountIn,s,c._params.contractAddress,c.data];return{data:n.interface.encodeFunctionData(l,m),to:d.MAYAN_FORWARDER_CONTRACT,value:J(o),chainId:r,_forwarder:{method:l,params:m}}}else{let c=Lt(e,t,r,u),l="forwardERC20",m=[e.fromToken.contract,c._params.amountIn,s,c._params.contractAddress,c.data];return{data:n.interface.encodeFunctionData(l,m),to:d.MAYAN_FORWARDER_CONTRACT,value:J(o),chainId:r,_forwarder:{method:l,params:m}}}else{let{minMiddleAmount:c,evmSwapRouterAddress:l,evmSwapRouterCalldata:m}=e;if(!c||!l||!m)throw new Error("MCTP swap requires middle amount, router address and calldata");if(e.hasAuction){if(!Number(e.deadline64))throw new Error("MCTP order requires timeout");let y=Ut(e,t,a,r),f=g(e.minMiddleAmount,B);if(e.fromToken.contract===it){let b=y._params.params.amountIn;if(b<=p)throw new Error("Amount in is less than bridge fee");p!==BigInt(0)&&(b-=p),o=J(y._params.params.amountIn);let T="swapAndForwardEth",I=[b,l,m,e.mctpInputContract,f,y._params.contractAddress,y.data];return{data:n.interface.encodeFunctionData(T,I),to:d.MAYAN_FORWARDER_CONTRACT,value:J(o),chainId:r,_forwarder:{method:T,params:I}}}else{let b="swapAndForwardERC20",T=[e.fromToken.contract,y._params.params.amountIn,s,l,m,e.mctpInputContract,f,y._params.contractAddress,y.data];return{data:n.interface.encodeFunctionData(b,T),to:d.MAYAN_FORWARDER_CONTRACT,value:J(o),chainId:r,_forwarder:{method:b,params:T}}}}else{let y=Lt(e,t,r,u),f=g(e.minMiddleAmount,B);if(e.fromToken.contract===it){let b=y._params.amountIn;if(b<=p)throw new Error("Amount in is less than bridge fee");p!==BigInt(0)&&(b-=p),o=J(y._params.amountIn);let T="swapAndForwardEth",I=[b,l,m,e.mctpInputContract,f,y._params.contractAddress,y.data];return{data:n.interface.encodeFunctionData(T,I),to:d.MAYAN_FORWARDER_CONTRACT,value:J(o),chainId:r,_forwarder:{method:T,params:I}}}else{let b="swapAndForwardERC20",T=[e.fromToken.contract,y._params.amountIn,s,l,m,e.mctpInputContract,f,y._params.contractAddress,y.data];return{data:n.interface.encodeFunctionData(b,T),to:d.MAYAN_FORWARDER_CONTRACT,value:J(o),chainId:r,_forwarder:{method:b,params:T}}}}}}import{Contract as Mn,toBeHex as ze,ZeroAddress as Je}from"ethers";import{Keypair as La,SystemProgram as _n}from"@solana/web3.js";var Ht={_format:"hh-sol-artifact-1",contractName:"MayanSwift",sourceName:"src/MayanSwift.sol",abi:[{inputs:[{internalType:"address",name:"_wormhole",type:"address"},{internalType:"address",name:"_feeManager",type:"address"},{internalType:"uint16",name:"_auctionChainId",type:"uint16"},{internalType:"bytes32",name:"_auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"_solanaEmitter",type:"bytes32"},{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"DeadlineViolation",type:"error"},{inputs:[],name:"DuplicateOrder",type:"error"},{inputs:[],name:"FeesTooHigh",type:"error"},{inputs:[],name:"InvalidAction",type:"error"},{inputs:[],name:"InvalidAmount",type:"error"},{inputs:[],name:"InvalidAuctionMode",type:"error"},{inputs:[],name:"InvalidBpsFee",type:"error"},{inputs:[],name:"InvalidContractSignature",type:"error"},{inputs:[],name:"InvalidDestChain",type:"error"},{inputs:[],name:"InvalidEmitterAddress",type:"error"},{inputs:[],name:"InvalidEmitterChain",type:"error"},{inputs:[],name:"InvalidEvmAddr",type:"error"},{inputs:[],name:"InvalidGasDrop",type:"error"},{inputs:[],name:"InvalidOrderHash",type:"error"},{inputs:[],name:"InvalidOrderStatus",type:"error"},{inputs:[],name:"InvalidSignature",type:"error"},{inputs:[],name:"InvalidSignatureLength",type:"error"},{inputs:[],name:"InvalidSigner",type:"error"},{inputs:[],name:"InvalidSrcChain",type:"error"},{inputs:[],name:"InvalidWormholeFee",type:"error"},{inputs:[],name:"OrderNotExists",type:"error"},{inputs:[],name:"Paused",type:"error"},{inputs:[],name:"SmallAmountIn",type:"error"},{inputs:[],name:"Unauthorized",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint64",name:"sequence",type:"uint64"}],name:"OrderCanceled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"}],name:"OrderCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint64",name:"sequence",type:"uint64"},{indexed:!1,internalType:"uint256",name:"netAmount",type:"uint256"}],name:"OrderFulfilled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"netAmount",type:"uint256"}],name:"OrderRefunded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"}],name:"OrderUnlocked",type:"event"},{inputs:[],name:"auctionAddr",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"auctionChainId",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"bytes32",name:"canceler",type:"bytes32"}],name:"cancelOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"consistencyLevel",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"}],name:"createOrderWithEth",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"bytes",name:"signedOrderHash",type:"bytes"}],name:"createOrderWithSig",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"}],name:"createOrderWithToken",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"feeManager",outputs:[{internalType:"contract IFeeManager",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"fulfillAmount",type:"uint256"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"bytes32",name:"recepient",type:"bytes32"},{internalType:"bool",name:"batch",type:"bool"}],name:"fulfillOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"fulfillAmount",type:"uint256"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"bytes32",name:"recepient",type:"bytes32"},{internalType:"bool",name:"batch",type:"bool"}],name:"fulfillSimple",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextGuardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"orders",outputs:[{internalType:"enum MayanSwift.Status",name:"status",type:"uint8"},{internalType:"uint64",name:"amountIn",type:"uint64"},{internalType:"uint16",name:"destChainId",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseFulfillPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"driver",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"promisedAmount",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"}],internalType:"struct MayanSwift.FulfillMsg",name:"fulfillMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseRefundPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"},{internalType:"bytes32",name:"canceler",type:"bytes32"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwift.RefundMsg",name:"refundMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseUnlockPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"}],internalType:"struct MayanSwift.UnlockMsg",name:"unlockMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32[]",name:"orderHashes",type:"bytes32[]"}],name:"postBatch",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"refundOrder",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],name:"setConsistencyLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_feeManager",type:"address"}],name:"setFeeManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"solanaEmitter",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockBatch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"unlockMsgs",outputs:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockSingle",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wormhole",outputs:[{internalType:"contract IWormhole",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],linkReferences:{},deployedLinkReferences:{}};import{Connection as We,Keypair as la,PublicKey as v,SystemProgram as be,SYSVAR_RENT_PUBKEY as Jt,Transaction as ot,TransactionInstruction as pe,AddressLookupTableAccount as Qt,ComputeBudgetProgram as da}from"@solana/web3.js";import{Buffer as ce}from"buffer";import{blob as Zt,struct as Ke,u8 as Le}from"@solana/buffer-layout";import{sha256 as ma}from"js-sha256";import ya from"bs58";var fa={};function ba(e){return fa[e]??=new We(e),new We(e)}async function Ue({trx:e,connection:t,errorChance:a,extraRpcs:r,options:i,rate:u=8}){let s=null,n=0,p=[t].concat(r.map(ba));for(let o=0;o<u;o++){if(s)try{let l=await Promise.any(p.map(m=>m.getSignatureStatus(s)));if(l&&l.value){if(l.value.err){if(n>=a)return{signature:s,serializedTrx:e};n++}else if(l.value.confirmationStatus==="confirmed")return{signature:s,serializedTrx:e}}}catch(l){console.error(l)}let c=p.map(l=>l.sendRawTransaction(e,i));if(!s)try{s=await Promise.any(c)}catch(l){console.error("Transaction not submitted, remaining attempts:",u-o-1,l)}await Fe(1e3)}if(!s)throw new Error("Failed to send transaction");return{signature:s,serializedTrx:e}}function Y(e,t,a,r,i=new v(d.TOKEN_PROGRAM_ID),u=new v(d.ASSOCIATED_TOKEN_PROGRAM_ID)){let s=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:be.programId,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:Jt,isSigner:!1,isWritable:!1}];return new pe({keys:s,programId:u,data:ce.alloc(0)})}var Vt=165;async function Ge(e,t,a,r,i,u=new v(d.TOKEN_PROGRAM_ID)){let s=[],n=await e.getMinimumBalanceForRentExemption(Vt);return s.push(be.createAccount({fromPubkey:t,newAccountPubkey:i.publicKey,lamports:n,space:Vt,programId:u})),s.push(new pe({keys:[{pubkey:i.publicKey,isWritable:!0,isSigner:!1},{pubkey:a,isWritable:!1,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:Jt,isWritable:!1,isSigner:!1}],programId:u,data:ce.from([1])})),s}var jt=Ke([Le("instruction"),Zt(8,"amount")]);function Xt(e,t,a,r,i=new v(d.TOKEN_PROGRAM_ID)){let u=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!1}],s=ce.alloc(jt.span);return jt.encode({instruction:4,amount:R(r)},s),new pe({keys:u,programId:i,data:s})}var Yt=Ke([Le("instruction")]);function Me(e){let t=[{pubkey:e,isSigner:!1,isWritable:!0}],a=ce.alloc(Yt.span);return Yt.encode({instruction:17},a),new pe({keys:t,programId:new v(d.TOKEN_PROGRAM_ID),data:a})}var $t=Ke([Le("instruction")]);function Ta(e,t,a,r=new v(d.TOKEN_PROGRAM_ID)){let i=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}],u=ce.alloc($t.span);return $t.encode({instruction:9},u),new pe({keys:i,programId:r,data:u})}var zt=Ke([Le("instruction"),Zt(8,"amount")]);function _e(e,t,a,r,i=new v(d.TOKEN_PROGRAM_ID)){let u=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}],s=ce.alloc(zt.span);return zt.encode({instruction:3,amount:R(r)},s),new pe({keys:u,programId:i,data:s})}var se=new v("So11111111111111111111111111111111111111112");async function jr(e,t,a,r){let i=r??new We("https://rpc.ankr.com/solana"),u=F(se,e,!1),{blockhash:s,lastValidBlockHeight:n}=await i.getLatestBlockhash(),p=new ot({feePayer:e,blockhash:s,lastValidBlockHeight:n}),o=await i.getAccountInfo(u,"finalized");(!o||o.data.length===0)&&p.add(Y(e,u,e,se)),p.add(be.transfer({fromPubkey:e,toPubkey:u,lamports:g(t,9)})),p.add(Me(u));let c=await a(p);return await Ue({trx:c.serialize(),connection:i,errorChance:1,extraRpcs:[]})}async function Yr(e,t,a,r){let i=r??new We("https://rpc.ankr.com/solana"),u=F(se,e,!1),s=la.generate(),{blockhash:n,lastValidBlockHeight:p}=await i.getLatestBlockhash(),o=new ot({feePayer:e,blockhash:n,lastValidBlockHeight:p}),c=F(se,s.publicKey,!1);o.add(Y(e,c,s.publicKey,se)),o.add(_e(u,c,e,g(t,9))),o.add(Ta(c,e,s.publicKey)),o.partialSign(s);let l=await a(o);return await Ue({trx:l.serialize(),connection:i,errorChance:1,extraRpcs:[]})}function Ne(e){return new pe({programId:new v(e.programId),keys:e.accounts.map(t=>({pubkey:new v(t.pubkey),isSigner:t.isSigner,isWritable:t.isWritable})),data:ce.from(e.data,"base64")})}async function He(e,t){return(await t.getMultipleAccountsInfo(e.map(r=>new v(r)))).reduce((r,i,u)=>{let s=e[u];if(i){let n=new Qt({key:new v(s),state:Qt.deserialize(i.data)});r.push(n)}return r},new Array)}function Qe(e,t){let a=Ne(e.swapInstruction),r=e.cleanupInstruction?Ne(e.cleanupInstruction):null,i=e.computeBudgetInstructions?e.computeBudgetInstructions.map(Ne):[],u=e.setupInstructions?e.setupInstructions.map(Ne):[];return{swapInstruction:a,cleanupInstruction:r,computeBudgetInstructions:i,setupInstructions:u,addressLookupTableAddresses:e.addressLookupTableAddresses}}function Z(e){let t=`global:${e}`;return ce.from(ma.digest(t)).subarray(0,8)}async function qt(){let e;try{let t=await vt();e=new v(t)}catch{console.log("Relayer not found, using system program"),e=be.programId}return e}function en(e,t,a,r){let i=r.jitoAccount||"Cw8CFyM9FkoMi7K7Crf6HNQqf4uEMzpKw6QNghXLvLkY";return new ot({feePayer:new v(e),blockhash:t,lastValidBlockHeight:a}).add(be.transfer({fromPubkey:new v(e),toPubkey:new v(i),lamports:r.tipLamports}))}async function ut(e,t,a=!1){try{let r=[];for(let s of e)r.push(s.serialize());let i={jsonrpc:"2.0",id:1,method:"sendBundle",params:[r.map(s=>ya.encode(s))]},u=await fetch(t.jitoSendUrl||"https://mainnet.block-engine.jito.wtf/api/v1/bundles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(u.status!==200&&u.status!==201)throw new Error("Send Jito bundle failed");return(await u.json()).result}catch(r){if(console.error("Send Jito bundle failed",r),a)throw r}}async function ga(e,t){let r=0;for(;r<5;)try{let i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getBundleStatuses",params:[e]})});if(!i.ok)throw new Error(`HTTP error! Status: ${i.status}`);let u=await i.json();if(u.error)throw new Error(`Error getting bundle statuses: ${JSON.stringify(u.error,null,2)}`);return u.result}catch(i){if(r++,await Fe(400),r>=5)throw new Error(`Failed to fetch bundle statuses after 5 attempts: ${i.message}`)}}async function tn(e,t,a,r,i){let s=Date.now();for(;Date.now()-s<9e4&&await i.getBlockHeight()<=a;){await Fe(350);let n=await ga([e],t.jitoSendUrl||"https://mainnet.block-engine.jito.wtf/api/v1/bundles");if(n&&n.value&&n.value.length>0&&n.value[0]){console.log("===>",n.value[0]);let p=n.value[0].confirmation_status;if(p==="confirmed"||p==="finalized"){let o=await i.getSignatureStatus(r);if(!o||!o.value)continue;if(o.value?.err)throw new Error(`Bundle failed with error: ${o.value.err}`);return}}}throw new Error("Bundle not confirmed, timeout")}async function nn(e){try{await fetch("https://explorer-api.mayan.finance/v3/submit/jito-bundle",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bundleId:e})})}catch{}}function wa(e){if(e){if(!e.programId.equals(new v(d.TOKEN_PROGRAM_ID))&&!e.programId.equals(new v(d.TOKEN_2022_PROGRAM_ID)))throw new Error("Invalid cleanup instruction:: programId");if(Uint8Array.from(e.data).length!==1)throw new Error("Invalid cleanup instruction:: data");if(Uint8Array.from(e.data)[0]!==9)throw new Error("Invalid cleanup instruction:: data")}}function Aa(e,t){if(!(e.length<1)){if(e.length>6)throw new Error("Invalid setup instruction:: too many instructions");e.forEach(a=>{if(!a.programId.equals(new v(d.ASSOCIATED_TOKEN_PROGRAM_ID))&&!a.programId.equals(be.programId)&&!a.programId.equals(new v(d.TOKEN_PROGRAM_ID))&&!a.programId.equals(new v(d.TOKEN_2022_PROGRAM_ID)))throw new Error("Invalid setup instruction:: programId");if(a.programId.equals(new v(d.ASSOCIATED_TOKEN_PROGRAM_ID))){if(Uint8Array.from(a.data).length===1){if(Uint8Array.from(a.data)[0]!==1)throw new Error("Invalid setup instruction:: data")}else if(Uint8Array.from(a.data).length!==0)throw new Error("Invalid setup instruction:: data")}else if(a.programId.equals(be.programId)){if(!t)throw new Error("Invalid setup instruction:: unknown transfer");let r=F(se,t,!0);if(a.data.readUint32LE()!==2)throw new Error("Invalid setup instruction:: invalid system program instruction");if(!a.keys[1].pubkey.equals(r))throw new Error("Invalid setup instruction:: invalid wrap transfer dest")}else if(a.data.toString("base64")!=="EQ==")throw new Error("Invalid setup instruction:: invalid token program instruction")})}}function Ia(e,t){if(!e.programId.equals(new v("JUP6LkbZbjS1jKKwapdHNy74zcZ3tLUZoi5QNyVTaV4")))throw new Error("Invalid swap instruction:: programId");if(e.data.subarray(0,8).toString("hex")===Z("shared_accounts_route").toString("hex")){if(!e.keys[6].pubkey.equals(t))throw new Error("Invalid swap instruction shared_accounts_route:: dest account")}else if(e.data.subarray(0,8).toString("hex")===Z("route").toString("hex")){if(!e.keys[4].pubkey.equals(t))throw new Error("Invalid swap instruction route:: dest account")}else throw new Error("Invalid swap instruction:: ix id")}function ha(e){e.forEach(t=>{if(!t.programId.equals(da.programId))throw new Error("Invalid compute budget instruction:: programId");if(Uint8Array.from(t.data)[0]===3&&t.data.readBigUInt64LE(1)>100000000n)throw new Error("Invalid compute budget instruction:: to high tx fee")})}function Pe(e,t,a){ha(e.computeBudgetInstructions),Aa(e.setupInstructions,a),Ia(e.swapInstruction,t),wa(e.cleanupInstruction)}function Ve(e,t,a,r,i,u=new v("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA")){return new pe({keys:[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1}],programId:new v("B96dV3Luxzo6SokJx3xt8i5y8Mb7HRR6Eec8hCjJDT69"),data:Z("transfer_all_and_close")})}import{Connection as Sn,PublicKey as j,Keypair as lt,SystemProgram as $e,SYSVAR_CLOCK_PUBKEY as Fa,SYSVAR_RENT_PUBKEY as Da,Transaction as An,TransactionInstruction as va,ComputeBudgetProgram as xa,MessageV0 as In,VersionedTransaction as dt}from"@solana/web3.js";import{blob as le,struct as Ba,u16 as Na,u8 as Ce}from"@solana/buffer-layout";import{Buffer as de}from"buffer";import{ZeroAddress as mt}from"ethers";import{PublicKey as M,Keypair as Ae,SystemProgram as Te,SYSVAR_CLOCK_PUBKEY as Ca,SYSVAR_RENT_PUBKEY as Sa,TransactionInstruction as ke,ComputeBudgetProgram as Ma}from"@solana/web3.js";import{blob as N,struct as Ee,u16 as fn,u8 as pt}from"@solana/buffer-layout";import{Buffer as Q}from"buffer";import{PublicKey as we}from"@solana/web3.js";import{Buffer as je}from"buffer";function an(e){let t=new we(d.WORMHOLE_PROGRAM_ID),a=new we(e),[r]=we.findProgramAddressSync([je.from("Bridge")],t),[i]=we.findProgramAddressSync([je.from("emitter")],a),[u]=we.findProgramAddressSync([je.from("Sequence"),i.toBuffer()],t),[s]=we.findProgramAddressSync([je.from("fee_collector")],t);return{bridgeConfig:r,sequenceKey:u,feeCollector:s,emitter:i}}var rn=Ee([N(8,"instruction")]);function sn(e,t,a,r,i){let u=new M(d.WORMHOLE_PROGRAM_ID),s=new M(d.TOKEN_PROGRAM_ID),n=new M(d.CCTP_CORE_PROGRAM_ID),p=new M(d.CCTP_TOKEN_PROGRAM_ID),o=new M(d.MCTP_PROGRAM_ID),c=new M(r),l=new M(a),m=F(l,e,!0),y;i&&i>BigInt(0)?y=F(l,c,!1):y=new M(d.MCTP_PROGRAM_ID);let f=Be(l,t),b=an(d.MCTP_PROGRAM_ID),T=Ae.generate(),I=Ae.generate(),w=[{pubkey:e,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!0},{pubkey:y,isWritable:!0,isSigner:!1},{pubkey:l,isWritable:!0,isSigner:!1},{pubkey:f.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:f.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:f.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:f.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:f.localToken,isWritable:!0,isSigner:!1},{pubkey:f.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:f.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:T.publicKey,isWritable:!0,isSigner:!0},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:b.emitter,isWritable:!1,isSigner:!1},{pubkey:b.bridgeConfig,isWritable:!0,isSigner:!1},{pubkey:b.sequenceKey,isWritable:!0,isSigner:!1},{pubkey:b.feeCollector,isWritable:!0,isSigner:!1},{pubkey:I.publicKey,isWritable:!0,isSigner:!0},{pubkey:u,isWritable:!1,isSigner:!1},{pubkey:Ca,isWritable:!1,isSigner:!1},{pubkey:Sa,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:Te.programId,isWritable:!1,isSigner:!1}],C=Q.alloc(rn.span);return rn.encode({instruction:Z("bridge_with_fee")},C),{instruction:new ke({keys:w,data:C,programId:o}),signers:[T,I]}}var on=Ee([N(8,"instruction")]);function un(e,t,a,r,i){let u=[],s=new M(d.TOKEN_PROGRAM_ID),n=new M(d.ASSOCIATED_TOKEN_PROGRAM_ID),p=new M(d.CCTP_CORE_PROGRAM_ID),o=new M(d.CCTP_TOKEN_PROGRAM_ID),c=new M(d.MCTP_PROGRAM_ID),l=new M(r),m=new M(a),y=F(m,e,!0),f=Be(m,t),b=Ae.generate(),[T]=M.findProgramAddressSync([Q.from("LOCKED_FEE"),m.toBuffer(),b.publicKey.toBytes()],c),I;i&&i>BigInt(0)?I=F(m,l,!1):I=new M(d.MCTP_PROGRAM_ID);let w=F(m,T,!0);u.push(Y(l,w,T,m));let C=[{pubkey:e,isWritable:!0,isSigner:!1},{pubkey:y,isWritable:!0,isSigner:!1},{pubkey:l,isWritable:!0,isSigner:!0},{pubkey:I,isWritable:!0,isSigner:!1},{pubkey:T,isWritable:!0,isSigner:!1},{pubkey:w,isWritable:!0,isSigner:!1},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:f.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:f.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:f.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:f.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:f.localToken,isWritable:!0,isSigner:!1},{pubkey:f.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:f.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:b.publicKey,isWritable:!0,isSigner:!0},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:p,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:Te.programId,isWritable:!1,isSigner:!1}],k=Q.alloc(on.span);on.encode({instruction:Z("bridge_locked_fee")},k);let _=new ke({keys:C,data:k,programId:c});return u.push(_),{instructions:u,signer:b}}var pn=Ee([N(8,"instruction")]);function cn(e,t,a,r,i){let u=new M(d.TOKEN_PROGRAM_ID),s=new M(d.CCTP_CORE_PROGRAM_ID),n=new M(d.CCTP_TOKEN_PROGRAM_ID),p=new M(d.MCTP_PROGRAM_ID),o=new M(r),c=new M(a),l=F(c,e,!0),m=Be(c,t),y=Ae.generate(),[f]=M.findProgramAddressSync([Q.from("ORDER_SOLANA_SOURCE"),e.toBuffer()],p),b;i&&i>BigInt(0)?b=F(c,o,!1):b=new M(d.MCTP_PROGRAM_ID);let T=[{pubkey:e,isWritable:!1,isSigner:!1},{pubkey:l,isWritable:!0,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!0},{pubkey:b,isWritable:!0,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!1},{pubkey:f,isWritable:!0,isSigner:!1},{pubkey:m.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:m.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:m.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:m.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:m.localToken,isWritable:!0,isSigner:!1},{pubkey:m.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:m.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:y.publicKey,isWritable:!0,isSigner:!0},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:new M(d.FEE_MANAGER_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:u,isWritable:!1,isSigner:!1},{pubkey:Te.programId,isWritable:!1,isSigner:!1}],I=Q.alloc(pn.span);return pn.encode({instruction:Z("create_order")},I),{instruction:new ke({keys:T,data:I,programId:p}),signer:y}}var ln=Ee([N(8,"instruction"),N(32,"destAddress"),N(8,"amountInMin"),N(8,"gasDrop"),N(8,"feeRedeem"),N(8,"feeSolana"),fn("destinationChain"),N(32,"keyRnd"),pt("mode")]);function dn(e){if(e.mode!=="WITH_FEE"&&e.mode!=="LOCK_FEE")throw new Error("Invalid mode: "+e.mode);let t=new M(e.swapperAddress),a=new M(e.mintAddress),r=F(a,e.ledger,!0),i=S(e.toChain),u=Q.from(K(A(e.destinationAddress,i))),s=R(e.amountInMin64),n=R(g(e.gasDrop,Math.min(D(e.toChain),8))),p=R(g(e.feeRedeem,B)),o=R(e.feeSolana),c=e.referrerAddress?Q.from(K(A(e.referrerAddress,i))):Te.programId.toBuffer(),l=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:e.customPayload||new M(d.MCTP_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:a,isWritable:!1,isSigner:!1},{pubkey:Te.programId,isWritable:!1,isSigner:!1},{pubkey:new M(c),isWritable:!1,isSigner:!1}],m=Q.alloc(ln.span);return ln.encode({instruction:Z("init_bridge_ledger"),destAddress:u,amountInMin:s,gasDrop:n,feeRedeem:p,feeSolana:o,destinationChain:i,keyRnd:e.randomKey.toBuffer(),mode:e.mode==="WITH_FEE"?1:2},m),new ke({keys:l,data:m,programId:new M(d.MCTP_PROGRAM_ID)})}var mn=Ee([N(8,"instruction"),N(32,"destAddress"),N(8,"amountInMin"),N(8,"gasDrop"),N(8,"feeRedeem"),N(8,"feeSolana"),fn("destinationChain"),N(32,"keyRnd"),pt("mode"),N(32,"tokenOut"),N(8,"amountOutMin"),N(8,"deadline"),N(32,"refAddress"),pt("feeRateRef")]);function yn(e){let t=new M(e.swapperAddress),a=new M(e.mintAddress),r=F(a,e.ledger,!0),i=S(e.toChain),u=Q.from(K(A(e.destinationAddress,i))),s=R(e.amountInMin64),n=R(g(e.gasDrop,Math.min(D(e.toChain),8))),p=R(g(e.feeRedeem,B)),o=R(e.feeSolana),c=Q.from(K(A(e.tokenOut,i))),l=e.referrerAddress?Q.from(K(A(e.referrerAddress,i))):Te.programId.toBuffer(),m=R(g(e.amountOutMin,Math.min(8,e.tokenOutDecimals))),y=R(e.deadline),f=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:a,isWritable:!1,isSigner:!1},{pubkey:Te.programId,isWritable:!1,isSigner:!1}],b=Q.alloc(mn.span);return mn.encode({instruction:Z("init_order_ledger"),destAddress:u,amountInMin:s,gasDrop:n,feeRedeem:p,feeSolana:o,destinationChain:i,keyRnd:e.randomKey.toBuffer(),mode:3,tokenOut:c,refAddress:l,amountOutMin:m,deadline:y,feeRateRef:e.feeRateRef},b),new ke({keys:f,data:b,programId:new M(d.MCTP_PROGRAM_ID)})}async function bn(e,t,a,r,i,u={}){let s=u?.forceSkipCctpInstructions||!1,n=u?.allowSwapperOffCurve||!1;if(e.toChain==="solana")throw new Error("Unsupported destination chain: "+e.toChain);let p=[],o=[],c=[],l=[],m=[],y=[],f=[],b=Ae.generate(),T=null;p.push(d.LOOKUP_TABLE);let I=new M(d.MCTP_PROGRAM_ID),w=new M(t),C=Ae.generate(),k=e.deadline64?BigInt(e.deadline64):BigInt(0);if(e.hasAuction&&!Number(e.deadline64))throw new Error("Swap mode requires a timeout");let _=e.hasAuction?"LEDGER_ORDER":"LEDGER_BRIDGE",[h]=M.findProgramAddressSync([Q.from(_),w.toBytes(),C.publicKey.toBytes()],I),E=F(new M(e.mctpInputContract),h,!0),x=e.cheaperChain==="solana"?"LOCK_FEE":"WITH_FEE",L=e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract;if(e.fromToken.contract===e.mctpInputContract){let P=BigInt(s?e.solanaRelayerFee64:0);if(e.suggestedPriorityFee>0&&o.push(Ma.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),o.push(Y(w,E,h,new M(e.mctpInputContract))),o.push(_e(F(new M(e.mctpInputContract),w,n),E,w,BigInt(e.effectiveAmountIn64))),e.hasAuction){if(o.push(yn({ledger:h,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:C.publicKey,toChain:e.toChain,destinationAddress:a,feeSolana:P,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:BigInt(e.effectiveAmountIn64),tokenOut:L,tokenOutDecimals:e.toToken.decimals,referrerAddress:r,amountOutMin:e.minAmountOut,deadline:k,feeRateRef:e.referrerBps})),!s){let{instruction:O,signer:U}=cn(h,e.toChain,e.mctpInputContract,t,P);o.push(O),c.push(U)}}else if(o.push(dn({ledger:h,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:C.publicKey,toChain:e.toChain,destinationAddress:a,feeSolana:P,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:BigInt(e.effectiveAmountIn64),mode:x,referrerAddress:r})),!s)if(x==="WITH_FEE"){let{instruction:O,signers:U}=sn(h,e.toChain,e.mctpInputContract,t,P);o.push(O),c.push(...U)}else{let{instructions:O,signer:U}=un(h,e.toChain,e.mctpInputContract,t,P);o.push(...O),c.push(U)}}else{let P=await xe({minMiddleAmount:e.minMiddleAmount,middleToken:e.mctpInputContract,userWallet:t,userLedger:h.toString(),slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn64:e.effectiveAmountIn64,depositMode:e.hasAuction?"SWAP":x,fillMaxAccounts:u?.separateSwapTx||!1,tpmTokenAccount:u?.separateSwapTx?b.publicKey.toString():null}),O=Qe(P,i);u?.separateSwapTx&&P.maxAccountsFilled?(Pe(O,b.publicKey,w),f=await Ge(i,w,new M(e.mctpInputContract),w,b),y.push(...O.computeBudgetInstructions),O.setupInstructions&&y.push(...O.setupInstructions),y.push(O.swapInstruction),O.cleanupInstruction&&y.push(O.cleanupInstruction),m.push(...O.addressLookupTableAddresses),o.push(Y(w,E,h,new M(e.mctpInputContract))),o.push(Ve(w,new M(e.mctpInputContract),b.publicKey,E,w))):(Pe(O,E,w),o.push(...O.computeBudgetInstructions),O.setupInstructions&&o.push(...O.setupInstructions),o.push(O.swapInstruction),O.cleanupInstruction&&o.push(O.cleanupInstruction),p.push(...O.addressLookupTableAddresses));let U=y.length>0?BigInt(0):BigInt(e.solanaRelayerFee64);if(e.hasAuction){if(o.push(yn({ledger:h,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:C.publicKey,toChain:e.toChain,destinationAddress:a,feeSolana:U,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:g(e.minMiddleAmount,B),tokenOut:L,tokenOutDecimals:e.toToken.decimals,referrerAddress:r,amountOutMin:e.minAmountOut,deadline:k,feeRateRef:e.referrerBps})),y.length>0){let{instruction:ue,signer:z}=cn(h,e.toChain,e.mctpInputContract,t,U);o.push(ue),c.push(z)}}else if(o.push(dn({ledger:h,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:C.publicKey,toChain:e.toChain,destinationAddress:a,feeSolana:U,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin64:g(e.minMiddleAmount,B),mode:x,referrerAddress:r})),y.length>0)if(x==="WITH_FEE"){let{instruction:ue,signers:z}=sn(h,e.toChain,e.mctpInputContract,t,U);o.push(ue),c.push(...z)}else{let{instructions:ue,signer:z}=un(h,e.toChain,e.mctpInputContract,t,U);o.push(...ue),c.push(z)}}let W=await He(p.concat(m),i);if(l=W.slice(0,p.length),y.length>0){let P=W.slice(p.length);T={messageV0:{payerKey:w,instructions:y,addressLookupTableAccounts:P},createTmpTokenAccountIxs:f,tmpTokenAccount:b}}return{instructions:o,signers:c,lookupTables:l,swapMessageV0Params:T}}import{PublicKey as oe,Keypair as Tn,SystemProgram as Ie,TransactionInstruction as _a,ComputeBudgetProgram as Pa}from"@solana/web3.js";import{blob as $,struct as ka,u16 as Ea,u8 as Ye}from"@solana/buffer-layout";import{Buffer as V}from"buffer";import{ethers as Ra,ZeroAddress as he}from"ethers";function ct(e,t,a,r,i){let s=V.alloc(239),n=0,p=S(e.fromChain),o=V.from(K(A(t,p)));s.set(o,0),n+=32,s.writeUInt16BE(p,n),n+=2;let c=e.swiftInputContract===he?A(Ie.programId.toString(),S("solana")):A(e.swiftInputContract,p),l=V.from(K(c));s.set(l,n),n+=32;let m=S(e.toChain),y=V.from(K(A(a,m)));s.set(y,n),n+=32,s.writeUInt16BE(m,n),n+=2;let f=e.toToken.contract===he?A(Ie.programId.toString(),S("solana")):A(e.toToken.contract,m),b=V.from(K(f));s.set(b,n),n+=32,s.writeBigUInt64BE(g(e.minAmountOut,Math.min(e.toToken.decimals,8)),n),n+=8,s.writeBigUInt64BE(g(e.gasDrop,Math.min(D(e.toChain),8)),n),n+=8,s.writeBigUInt64BE(BigInt(e.cancelRelayerFee64),n),n+=8,s.writeBigUInt64BE(BigInt(e.refundRelayerFee64),n),n+=8,s.writeBigUInt64BE(BigInt(e.deadline64),n),n+=8;let T=r?V.from(K(A(r,m))):Ie.programId.toBuffer();s.set(T,n),n+=32,s.writeUInt8(e.referrerBps,n),n+=1;let I=e.protocolBps;s.writeUInt8(I,n),n+=1,s.writeUInt8(e.swiftAuctionMode,n),n+=1;let w=V.from(K(i));if(s.set(w,n),n+=32,n!==239)throw new Error(`Invalid order data size: ${n}`);let C=Ra.keccak256(s);return V.from(K(C))}var gn=ka([$(8,"instruction"),$(8,"amountInMin"),Ye("nativeInput"),$(8,"feeSubmit"),$(32,"destAddress"),Ea("destinationChain"),$(32,"tokenOut"),$(8,"amountOutMin"),$(8,"gasDrop"),$(8,"feeCancel"),$(8,"feeRefund"),$(8,"deadline"),$(32,"refAddress"),Ye("feeRateRef"),Ye("feeRateMayan"),Ye("auctionMode"),$(32,"randomKey")]);function Oa(e){let{quote:t}=e,a=t.swiftInputContract===he?se:new oe(t.swiftInputContract),r=S(t.toChain);if(r!==t.toToken.wChainId)throw new Error(`Destination chain ID mismatch: ${r} != ${t.toToken.wChainId}`);let i=[{pubkey:e.trader,isWritable:!1,isSigner:!0},{pubkey:e.relayer,isWritable:!0,isSigner:!0},{pubkey:e.state,isWritable:!0,isSigner:!1},{pubkey:e.stateAccount,isWritable:!0,isSigner:!1},{pubkey:e.relayerAccount,isWritable:!0,isSigner:!1},{pubkey:a,isWritable:!1,isSigner:!1},{pubkey:new oe(d.FEE_MANAGER_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:new oe(d.TOKEN_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:Ie.programId,isWritable:!1,isSigner:!1}],u=V.alloc(gn.span),s=e.referrerAddress?V.from(K(A(e.referrerAddress,r))):Ie.programId.toBuffer(),n=t.fromToken.contract===t.swiftInputContract?BigInt(t.effectiveAmountIn64):g(t.minMiddleAmount,t.swiftInputDecimals);return gn.encode({instruction:Z("init_order"),amountInMin:R(n),nativeInput:t.swiftInputContract===he?1:0,feeSubmit:R(BigInt(t.submitRelayerFee64)),destAddress:V.from(K(A(e.destinationAddress,r))),destinationChain:r,tokenOut:V.from(K(A(t.toToken.contract,r))),amountOutMin:R(g(t.minAmountOut,Math.min(t.toToken.decimals,8))),gasDrop:R(g(t.gasDrop,Math.min(D(t.toChain),8))),feeCancel:R(BigInt(t.cancelRelayerFee64)),feeRefund:R(BigInt(t.refundRelayerFee64)),deadline:R(e.deadline),refAddress:s,feeRateRef:t.referrerBps,feeRateMayan:t.protocolBps,auctionMode:t.swiftAuctionMode,randomKey:e.randomKey.toBuffer()},u),new _a({keys:i,data:u,programId:new oe(d.SWIFT_PROGRAM_ID)})}async function wn(e,t,a,r,i,u={}){if(e.type!=="SWIFT")throw new Error("Unsupported quote type for Swift: "+e.type);if(e.toChain==="solana")throw new Error("Unsupported destination chain: "+e.toChain);let s=u.allowSwapperOffCurve||!1,n=[],p=[],o=[];o.push(d.LOOKUP_TABLE);let c=[],l=[],m=[],y=Tn.generate(),f=null,b=new oe(d.SWIFT_PROGRAM_ID),T=new oe(t),I=Tn.generate();if(!Number(e.deadline64))throw new Error("Swift mode requires a timeout");let w=BigInt(e.deadline64),C=ct(e,t,a,r,I.publicKey.toBuffer().toString("hex")),[k]=oe.findProgramAddressSync([V.from("STATE_SOURCE"),C],b),_=e.swiftInputContract===he?se:new oe(e.swiftInputContract),h=F(_,k,!0),E=e.gasless?new oe(e.relayer):T,x=F(_,E,!1);if(e.fromToken.contract===e.swiftInputContract)e.suggestedPriorityFee>0&&n.push(Pa.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),n.push(Y(E,h,k,_)),e.swiftInputContract===he?n.push(Ie.transfer({fromPubkey:T,toPubkey:h,lamports:BigInt(e.effectiveAmountIn64)}),Me(h)):n.push(_e(F(_,T,s),h,T,BigInt(e.effectiveAmountIn64)));else{let W=await xe({minMiddleAmount:e.minMiddleAmount,middleToken:e.swiftInputContract,userWallet:t,slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn64:e.effectiveAmountIn64,depositMode:e.gasless?"SWIFT_GASLESS":"SWIFT",orderHash:`0x${C.toString("hex")}`,fillMaxAccounts:u?.separateSwapTx||!1,tpmTokenAccount:u?.separateSwapTx?y.publicKey.toString():null}),P=Qe(W,i);u?.separateSwapTx&&W.maxAccountsFilled?(Pe(P,y.publicKey,T),m=await Ge(i,E,_,T,y),l.push(...P.computeBudgetInstructions),P.setupInstructions&&l.push(...P.setupInstructions),l.push(P.swapInstruction),P.cleanupInstruction&&l.push(P.cleanupInstruction),c.push(...P.addressLookupTableAddresses),n.push(Y(E,h,k,_)),n.push(Ve(T,_,y.publicKey,h,E))):(n.push(...P.computeBudgetInstructions),P.setupInstructions&&n.push(...P.setupInstructions),n.push(P.swapInstruction),P.cleanupInstruction&&n.push(P.cleanupInstruction),o.push(...P.addressLookupTableAddresses))}n.push(Oa({quote:e,state:k,trader:T,stateAccount:h,randomKey:I.publicKey,relayerAccount:x,relayer:E,destinationAddress:a,deadline:w,referrerAddress:r}));let L=await He(o.concat(c),i);if(p=L.slice(0,o.length),l.length>0){let W=L.slice(o.length);f={messageV0:{payerKey:E,instructions:l,addressLookupTableAccounts:W},createTmpTokenAccountIxs:m,tmpTokenAccount:y}}return{instructions:n,signers:[],lookupTables:p,swapMessageV0Params:f}}import hn from"bs58";var Wa=420,Cn=Ba([Ce("instruction"),Ce("stateNonce"),le(8,"amount"),le(8,"minAmountOut"),le(8,"deadline"),le(8,"feeSwap"),le(8,"feeReturn"),le(8,"feeCancel"),le(8,"gasDrop"),Na("destinationChain"),le(32,"destinationAddress"),Ce("unwrapRedeem"),Ce("unwrapRefund"),Ce("mayanFeeNonce"),Ce("referrerFeeNonce")]);async function Ka(e,t,a,r,i,u={}){let s=fe(e,r);if(e.type==="MCTP")return bn(e,t,a,s,i,u);if(e.type==="SWIFT")return wn(e,t,a,s,i,u);let n=[],p=i??new Sn("https://rpc.ankr.com/solana"),o=new j(d.MAYAN_PROGRAM_ID),c=new j(d.TOKEN_PROGRAM_ID),l=new j(t),m=new j(d.AUCTION_PROGRAM_ID);e.suggestedPriorityFee>0&&n.push(xa.setComputeUnitPrice({microLamports:e.suggestedPriorityFee}));let y;s?y=new j(s):y=$e.programId;let[f,b]=j.findProgramAddressSync([de.from("MAYANFEE")],o),[T,I]=j.findProgramAddressSync([de.from("REFERRERFEE"),y.toBuffer()],o),w=lt.generate(),C=lt.generate(),[k,_]=j.findProgramAddressSync([de.from("V2STATE"),de.from(w.publicKey.toBytes()),de.from(C.publicKey.toBytes())],o),h=new j(e.fromToken.mint),E=new j(e.toToken.mint),x=F(h,l),L=F(h,k,!0),[[W,P],O,U]=await Promise.all([p.getMultipleAccountsInfo([x,L],"finalized"),p.getMinimumBalanceForRentExemption(Wa),qt()]);(!W||W.data.length===0)&&n.push(Y(l,x,l,h)),(!P||P.data.length===0)&&n.push(Y(l,L,k,h)),e.fromToken.contract===mt&&(n.push($e.transfer({fromPubkey:l,toPubkey:x,lamports:BigInt(e.effectiveAmountIn64)})),n.push(Me(x)));let ue=BigInt(e.effectiveAmountIn64),z=lt.generate();n.push(Xt(x,z.publicKey,l,ue)),n.push($e.transfer({fromPubkey:l,toPubkey:z.publicKey,lamports:O}));let Qn=[{pubkey:z.publicKey,isWritable:!1,isSigner:!0},{pubkey:w.publicKey,isWritable:!1,isSigner:!0},{pubkey:C.publicKey,isWritable:!1,isSigner:!0},{pubkey:k,isWritable:!0,isSigner:!1},{pubkey:x,isWritable:!0,isSigner:!1},{pubkey:l,isWritable:!1,isSigner:!1},{pubkey:L,isWritable:!0,isSigner:!1},{pubkey:h,isWritable:!1,isSigner:!1},{pubkey:E,isWritable:!1,isSigner:!1},{pubkey:m,isWritable:!1,isSigner:!1},{pubkey:y,isWritable:!1,isSigner:!1},{pubkey:f,isWritable:!1,isSigner:!1},{pubkey:T,isWritable:!1,isSigner:!1},{pubkey:z.publicKey,isWritable:!0,isSigner:!0},{pubkey:U,isWritable:!1,isSigner:!1},{pubkey:Fa,isWritable:!1,isSigner:!1},{pubkey:Da,isWritable:!1,isSigner:!1},{pubkey:c,isWritable:!1,isSigner:!1},{pubkey:$e.programId,isWritable:!1,isSigner:!1}],Xe=S(e.toChain);if(Xe===1){let qe=await p.getAccountInfo(new j(a));if(qe&&qe.owner&&qe.owner.equals(c))throw new Error("Destination address is not about token account. It should be a owner address")}let Vn=de.from(K(A(a,Xe))),jn=g(e.minAmountOut,e.mintDecimals.to),Yn=g(e.swapRelayerFee,e.mintDecimals.from),$n=g(e.redeemRelayerFee,e.mintDecimals.to),zn=g(e.refundRelayerFee,e.mintDecimals.from),Jn=g(e.gasDrop,Et(e.toChain)),Zn=e.toToken.contract===mt,Xn=e.fromToken.contract===mt;if(!Number(e.deadline64))throw new Error("Deadline is not valid");let qn=BigInt(e.deadline64),St=de.alloc(Cn.span),ea={instruction:101,stateNonce:_,amount:R(ue),minAmountOut:R(jn),deadline:R(qn),feeSwap:R(Yn),feeReturn:R($n),feeCancel:R(zn),gasDrop:R(Jn),destinationChain:Xe,destinationAddress:Vn,unwrapRedeem:Zn?1:0,unwrapRefund:Xn?1:0,mayanFeeNonce:b,referrerFeeNonce:I};Cn.encode(ea,St);let ta=new va({keys:Qn,data:St,programId:o});return n.push(ta),{instructions:n,signers:[z,w,C],lookupTables:[],swapMessageV0Params:null}}async function Wi(e,t,a,r,i,u,s,n,p,o){let c=u??new Sn("https://rpc.ankr.com/solana"),l=!!(!e.gasless&&p&&p.tipLamports>0&&p.signAllTransactions),{instructions:m,signers:y,lookupTables:f,swapMessageV0Params:b}=await Ka(e,t,a,r,u,{allowSwapperOffCurve:o?.allowSwapperOffCurve,forceSkipCctpInstructions:o?.forceSkipCctpInstructions,separateSwapTx:l&&p?.separateSwapTx}),T=new j(t),I=e.gasless?new j(e.relayer):T,{blockhash:w,lastValidBlockHeight:C}=await u.getLatestBlockhash(),k=In.compile({instructions:m,payerKey:I,recentBlockhash:w,addressLookupTableAccounts:f}),_=new dt(k);_.sign(y);let h;if(l){let E=[];if(b){let P=new An({feePayer:T,blockhash:w,lastValidBlockHeight:C}).add(...b.createTmpTokenAccountIxs);P.partialSign(b.tmpTokenAccount),E.push(P);let O=In.compile({...b.messageV0,recentBlockhash:w});E.push(new dt(O))}let x=en(t,w,C,p);E.push(_),E.push(x);let L=await p.signAllTransactions(E);h=L[L.length-2];let W=null;if(h instanceof An&&h?.signatures[0]?.publicKey?W=hn.encode(Uint8Array.from(h.signatures[0].signature)):h instanceof dt&&h?.signatures[0]&&(W=hn.encode(Uint8Array.from(h.signatures[0]))),W===null)throw new Error("Failed to get mayan tx hash");if(b){let P=await ut(L,p,!0);return await tn(P,p,C,W,u),nn(P),{signature:W,serializedTrx:null}}else ut(L,p).then(()=>{console.log("Jito bundle sent")}).catch(()=>{})}else h=await i(_);if(e.gasless){let E=de.from(h.serialize()).toString("base64"),{orderHash:x}=await Nt(E);return{signature:x,serializedTrx:null}}return await Ue({trx:h.serialize(),connection:c,extraRpcs:s??[],errorChance:2,options:n})}function Pn(e,t,a,r,i){let u=H(Number(i)),s=S(e.fromChain),n=S(e.toChain);if(s!==u)throw new Error(`Signer chain id(${Number(i)}) and quote from chain are not same! ${s} !== ${u}`);if(!e.swiftMayanContract)throw new Error("SWIFT contract address is missing");if(e.toToken.wChainId!==n)throw new Error(`Destination chain ID mismatch: ${n} != ${e.toToken.wChainId}`);let p=e.swiftMayanContract;if(!Number(e.deadline64))throw new Error("Swift order requires timeout");let o=BigInt(e.deadline64),c=e.swiftInputContract,l=BigInt(e.effectiveAmountIn64),m;r?m=A(r,n):m=A(_n.programId.toString(),1);let y=A(La.generate().publicKey.toString(),1),f=e.toToken.contract===Je?A(_n.programId.toString(),1):A(e.toToken.contract,n),b=g(e.minAmountOut,Math.min(8,e.toToken.decimals)),T=g(e.gasDrop,Math.min(8,D(e.toChain))),I=A(a,n),w={trader:A(t,s),tokenOut:f,minAmountOut:b,gasDrop:T,cancelFee:BigInt(e.cancelRelayerFee64),refundFee:BigInt(e.refundRelayerFee64),deadline:o,destAddr:I,destChainId:n,referrerAddr:m,referrerBps:e.referrerBps||0,auctionMode:e.swiftAuctionMode,random:y};return{contractAddress:p,tokenIn:c,amountIn:l,order:w}}function kn(e,t,a,r,i,u){if(e.type!=="SWIFT")throw new Error("Quote type is not SWIFT");if(!Number.isFinite(Number(i)))throw new Error("Invalid signer chain id");if(!Number(e.deadline64))throw new Error("Swift order requires timeout");i=Number(i);let s=u||q,n=new Mn(d.MAYAN_FORWARDER_CONTRACT,ee.abi),{tokenIn:p,amountIn:o,order:c,contractAddress:l}=Pn(e,t,a,r,i),m,y=new Mn(l,Ht.abi);e.swiftInputContract===Je?m=y.interface.encodeFunctionData("createOrderWithEth",[c]):m=y.interface.encodeFunctionData("createOrderWithToken",[p,o,c]);let f,b,T;if(e.fromToken.contract===e.swiftInputContract)e.fromToken.contract===Je?(f="forwardEth",b=[l,m],T=ze(o)):(f="forwardERC20",b=[p,o,s,l,m],T=ze(0));else{let{evmSwapRouterAddress:w,evmSwapRouterCalldata:C}=e;if(!e.minMiddleAmount||!w||!C)throw new Error("Swift swap requires middle amount, router address and calldata");let k=e.fromToken.contract,_=g(e.minMiddleAmount,e.swiftInputDecimals);e.fromToken.contract===Je?(f="swapAndForwardEth",b=[o,w,C,e.swiftInputContract,_,l,m],T=ze(o)):(f="swapAndForwardERC20",b=[k,o,s,w,C,e.swiftInputContract,_,l,m],T=ze(0))}return{data:n.interface.encodeFunctionData(f,b),to:d.MAYAN_FORWARDER_CONTRACT,value:T,chainId:i,_forwarder:{method:f,params:b}}}function Ua(e,t,a){if(!Number.isFinite(Number(a)))throw new Error("Invalid signer chain id");let r=BigInt(e.effectiveAmountIn64),i=BigInt(e.submitRelayerFee64);return{domain:{name:"Mayan Swift",chainId:Number(a),verifyingContract:e.swiftMayanContract},types:{CreateOrder:[{name:"OrderId",type:"bytes32"},{name:"InputAmount",type:"uint256"},{name:"SubmissionFee",type:"uint256"}]},value:{OrderId:t,InputAmount:r-i,SubmissionFee:i}}}function En(e,t,a,r,i,u){if(e.type!=="SWIFT")throw new Error("Quote type is not SWIFT");if(!e.gasless)throw new Error("Quote does not support gasless");if(!Number.isFinite(Number(i)))throw new Error("Invalid signer chain id");if(!Number(e.deadline64))throw new Error("Swift order requires timeout");if(e.fromToken.contract!==e.swiftInputContract)throw new Error("Swift gasless order creation does not support source swap");let{tokenIn:s,amountIn:n,order:p}=Pn(e,t,a,r,Number(i)),o=S(e.fromChain),l=`0x${ct(e,t,a,r,p.random).toString("hex")}`,m=Ua(e,l,i);return{permitParams:u,orderParams:{...p,sourceChainId:o,amountIn:n,tokenIn:s,submissionFee:BigInt(e.submitRelayerFee64)},orderHash:l,orderTypedData:m}}import{Contract as On,toBeHex as yt,ZeroAddress as Fn}from"ethers";import{Buffer as X}from"buffer";var Rn={abi:[{type:"function",name:"batchMaxApprove",inputs:[{name:"approvals",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"initiate",inputs:[{name:"recipient",type:"bytes32",internalType:"bytes32"},{name:"overrideAmountIn",type:"uint256",internalType:"uint256"},{name:"targetChain",type:"uint16",internalType:"uint16"},{name:"params",type:"bytes",internalType:"bytes"}],outputs:[{name:"",type:"bytes",internalType:"bytes"}],stateMutability:"payable"},{type:"error",name:"ChainNotSupported",inputs:[{name:"chain",type:"uint16",internalType:"uint16"}]},{type:"error",name:"DeadlineExpired",inputs:[{name:"blocktime",type:"uint256",internalType:"uint256"},{name:"deadline",type:"uint256",internalType:"uint256"}]},{type:"error",name:"EthTransferFailed",inputs:[]},{type:"error",name:"ExceedsMaxGasDropoff",inputs:[{name:"requested",type:"uint256",internalType:"uint256"},{name:"maximum",type:"uint256",internalType:"uint256"}]},{type:"error",name:"ExceedsMaxRelayingFee",inputs:[{name:"fee",type:"uint256",internalType:"uint256"},{name:"maximum",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InsufficientInputAmount",inputs:[{name:"input",type:"uint256",internalType:"uint256"},{name:"minimum",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InvalidAddress",inputs:[{name:"addr",type:"bytes32",internalType:"bytes32"}]},{type:"error",name:"InvalidBoolVal",inputs:[{name:"val",type:"uint8",internalType:"uint8"}]},{type:"error",name:"InvalidOverrideAmount",inputs:[{name:"received",type:"uint256",internalType:"uint256"},{name:"maximum",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InvalidSwapType",inputs:[{name:"swapType",type:"uint256",internalType:"uint256"}]},{type:"error",name:"InvalidSwapTypeForChain",inputs:[{name:"chain",type:"uint16",internalType:"uint16"},{name:"swapType",type:"uint256",internalType:"uint256"}]},{type:"error",name:"LengthMismatch",inputs:[{name:"encodedLength",type:"uint256",internalType:"uint256"},{name:"expectedLength",type:"uint256",internalType:"uint256"}]},{type:"error",name:"RelayingDisabledForChain",inputs:[]}]};var me={FAST_MODE_FLAG:1,RELAY_REDEEM_MODE:2,EXACT_IN_FLAG:1,USDC_INPUT_TOKEN_TYPE:0,PRE_APPROVED_ACQUIRE_MODE:0,OUTPUT_USDC_MODE:0,OUTPUT_NATIVE_MODE:1,OUTPUT_OTHER_MODE:2};function Ga(e){let t=(1n<<128n)-1n;if(e<0n||e>t)throw new RangeError("Value must fit in an unsigned 128-bit integer (0 <= value < 2^128)");let a=X.alloc(16);for(let r=15;r>=0;r--)a[r]=Number(e&0xFFn),e>>=8n;return a}function Ha(e,t,a){let{shuttleParams:r}=e;if(!r)throw new Error("Swap layer params are missing in quote response");let i=H(Number(a)),u=S(e.fromChain),s=S(e.toChain);if(u!==i)throw new Error(`Signer chain id(${Number(a)}) and quote from chain are not same! ${u} !== ${i}`);let n=[];n.push(me.FAST_MODE_FLAG);let p=X.alloc(8);p.writeBigUInt64BE(BigInt(r.maxLLFee));let o=p.subarray(2);n.push(...o);let c=X.alloc(4);c.writeUInt32BE(r.fastTransferDeadline),n.push(...c),n.push(me.RELAY_REDEEM_MODE);let l=g(e.gasDrop,Math.min(6,D(e.toChain))),m=X.alloc(8);m.writeBigUInt64BE(l);let y=m.subarray(4);n.push(...y);let f=X.alloc(8);f.writeBigUInt64BE(BigInt(r.maxRelayingFee));let b=f.subarray(2);n.push(...b),n.push(me.EXACT_IN_FLAG),n.push(me.USDC_INPUT_TOKEN_TYPE);let T=BigInt(e.effectiveAmountIn64);if(e.fromToken.contract===e.shuttleInputContract){n.push(...Array(8).fill(0));let w=X.alloc(8);w.writeBigUInt64BE(T),n.push(...w)}else n.push(...Array(16).fill(0));if(n.push(me.PRE_APPROVED_ACQUIRE_MODE),r.hasDestSwap){if(e.toToken.contract===Fn)n.push(me.OUTPUT_NATIVE_MODE);else{n.push(me.OUTPUT_OTHER_MODE);let _=X.from(A(e.toToken.contract,s).slice(2),"hex");n.push(..._)}let w=X.alloc(4);w.writeUInt32BE(Number(BigInt(e.deadline64))),n.push(...w);let C=g(e.minAmountOut,e.toToken.decimals);if(e.toChain==="solana"){n.push(...Array(8).fill(0));let _=X.alloc(8);_.writeBigUInt64BE(C),n.push(..._)}else{let _=Ga(C);n.push(..._)}let k=X.from(r.path.slice(2),"hex");n.push(...k)}else n.push(me.OUTPUT_USDC_MODE);return{destAddr:A(t,s),destChainId:s,serializedParams:`0x${X.from(n).toString("hex")}`,contractAddress:e.shuttleContract,amountIn:T,bridgeFee:g(e.bridgeFee,D(e.fromChain))}}function Dn(e,t,a,r){if(e.type!=="SHUTTLE")throw new Error("Quote type is not SHUTTLE");if(!Number.isFinite(Number(a)))throw new Error("Invalid signer chain id");a=Number(a);let i=r||q,u=new On(d.MAYAN_FORWARDER_CONTRACT,ee.abi),{destAddr:s,destChainId:n,serializedParams:p,contractAddress:o,amountIn:c,bridgeFee:l}=Ha(e,t,a),m;m=new On(o,Rn.abi).interface.encodeFunctionData("initiate",[s,c,n,p]);let f,b,T;if(e.fromToken.contract===e.shuttleInputContract)f="forwardERC20",b=[e.shuttleInputContract,c,i,o,m],T=yt(l);else{let{evmSwapRouterAddress:w,evmSwapRouterCalldata:C}=e;if(!e.minMiddleAmount||!w||!C)throw new Error("Shuttle source chain swap requires middle amount, router address and calldata");let k=e.fromToken.contract,_=g(e.minMiddleAmount,e.shuttleInputDecimals);e.fromToken.contract===Fn?(f="swapAndForwardEth",b=[c,w,C,e.shuttleInputContract,_,o,m],T=yt(c)):(f="swapAndForwardERC20",b=[k,c,i,w,C,e.shuttleInputContract,_,o,m],T=yt(l))}return{data:u.interface.encodeFunctionData(f,b),to:d.MAYAN_FORWARDER_CONTRACT,value:T,chainId:a,_forwarder:{method:f,params:b}}}import{Contract as gt,toBeHex as ye,ZeroAddress as bt}from"ethers";import{SystemProgram as Tt}from"@solana/web3.js";var ft={abi:[{type:"constructor",inputs:[{name:"_cctpTokenMessengerV2",type:"address",internalType:"address"},{name:"_feeManager",type:"address",internalType:"address"}],stateMutability:"nonpayable"},{type:"receive",stateMutability:"payable"},{type:"function",name:"bridge",inputs:[{name:"tokenIn",type:"address",internalType:"address"},{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"redeemFee",type:"uint64",internalType:"uint64"},{name:"circleMaxFee",type:"uint256",internalType:"uint256"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"destAddr",type:"bytes32",internalType:"bytes32"},{name:"destDomain",type:"uint32",internalType:"uint32"},{name:"referrerAddress",type:"bytes32",internalType:"bytes32"},{name:"referrerBps",type:"uint8",internalType:"uint8"},{name:"payloadType",type:"uint8",internalType:"uint8"},{name:"minFinalityThreshold",type:"uint32",internalType:"uint32"},{name:"customPayload",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"cctpTokenMessengerV2",inputs:[],outputs:[{name:"",type:"address",internalType:"contract ITokenMessengerV2"}],stateMutability:"view"},{type:"function",name:"changeGuardian",inputs:[{name:"newGuardian",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"claimGuardian",inputs:[],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"createOrder",inputs:[{name:"tokenIn",type:"address",internalType:"address"},{name:"amountIn",type:"uint256",internalType:"uint256"},{name:"circleMaxFee",type:"uint256",internalType:"uint256"},{name:"destDomain",type:"uint32",internalType:"uint32"},{name:"minFinalityThreshold",type:"uint32",internalType:"uint32"},{name:"orderPayload",type:"tuple",internalType:"struct FastMCTP.OrderPayload",components:[{name:"payloadType",type:"uint8",internalType:"uint8"},{name:"destAddr",type:"bytes32",internalType:"bytes32"},{name:"tokenOut",type:"bytes32",internalType:"bytes32"},{name:"amountOutMin",type:"uint64",internalType:"uint64"},{name:"gasDrop",type:"uint64",internalType:"uint64"},{name:"redeemFee",type:"uint64",internalType:"uint64"},{name:"refundFee",type:"uint64",internalType:"uint64"},{name:"deadline",type:"uint64",internalType:"uint64"},{name:"referrerAddr",type:"bytes32",internalType:"bytes32"},{name:"referrerBps",type:"uint8",internalType:"uint8"}]}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"domainToCaller",inputs:[{name:"",type:"uint32",internalType:"uint32"}],outputs:[{name:"",type:"bytes32",internalType:"bytes32"}],stateMutability:"view"},{type:"function",name:"feeManager",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"fulfillOrder",inputs:[{name:"cctpMsg",type:"bytes",internalType:"bytes"},{name:"cctpSigs",type:"bytes",internalType:"bytes"},{name:"swapProtocol",type:"address",internalType:"address"},{name:"swapData",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"guardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"keyToMintRecipient",inputs:[{name:"",type:"bytes32",internalType:"bytes32"}],outputs:[{name:"",type:"bytes32",internalType:"bytes32"}],stateMutability:"view"},{type:"function",name:"nextGuardian",inputs:[],outputs:[{name:"",type:"address",internalType:"address"}],stateMutability:"view"},{type:"function",name:"paused",inputs:[],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"redeem",inputs:[{name:"cctpMsg",type:"bytes",internalType:"bytes"},{name:"cctpSigs",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"refund",inputs:[{name:"cctpMsg",type:"bytes",internalType:"bytes"},{name:"cctpSigs",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"payable"},{type:"function",name:"rescueEth",inputs:[{name:"amount",type:"uint256",internalType:"uint256"},{name:"to",type:"address",internalType:"address payable"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"rescueRedeem",inputs:[{name:"cctpMsg",type:"bytes",internalType:"bytes"},{name:"cctpSigs",type:"bytes",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"rescueToken",inputs:[{name:"token",type:"address",internalType:"address"},{name:"amount",type:"uint256",internalType:"uint256"},{name:"to",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setDomainCallers",inputs:[{name:"domain",type:"uint32",internalType:"uint32"},{name:"caller",type:"bytes32",internalType:"bytes32"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setFeeManager",inputs:[{name:"_feeManager",type:"address",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setMintRecipient",inputs:[{name:"destDomain",type:"uint32",internalType:"uint32"},{name:"tokenIn",type:"address",internalType:"address"},{name:"mintRecipient",type:"bytes32",internalType:"bytes32"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setPause",inputs:[{name:"_pause",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setWhitelistedMsgSenders",inputs:[{name:"sender",type:"address",internalType:"address"},{name:"isWhitelisted",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setWhitelistedSwapProtocols",inputs:[{name:"protocol",type:"address",internalType:"address"},{name:"isWhitelisted",type:"bool",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"whitelistedMsgSenders",inputs:[{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"whitelistedSwapProtocols",inputs:[{name:"",type:"address",internalType:"address"}],outputs:[{name:"",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"event",name:"OrderFulfilled",inputs:[{name:"sourceDomain",type:"uint32",indexed:!1,internalType:"uint32"},{name:"sourceNonce",type:"bytes32",indexed:!1,internalType:"bytes32"},{name:"amount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"event",name:"OrderRefunded",inputs:[{name:"sourceDomain",type:"uint32",indexed:!1,internalType:"uint32"},{name:"sourceNonce",type:"bytes32",indexed:!1,internalType:"bytes32"},{name:"amount",type:"uint256",indexed:!1,internalType:"uint256"}],anonymous:!1},{type:"error",name:"AlreadySet",inputs:[]},{type:"error",name:"CallerNotSet",inputs:[]},{type:"error",name:"CctpReceiveFailed",inputs:[]},{type:"error",name:"DeadlineViolation",inputs:[]},{type:"error",name:"EthTransferFailed",inputs:[]},{type:"error",name:"InvalidAddress",inputs:[]},{type:"error",name:"InvalidAmountOut",inputs:[]},{type:"error",name:"InvalidGasDrop",inputs:[]},{type:"error",name:"InvalidMintRecipient",inputs:[]},{type:"error",name:"InvalidPayload",inputs:[]},{type:"error",name:"InvalidPayloadType",inputs:[]},{type:"error",name:"InvalidRedeemFee",inputs:[]},{type:"error",name:"InvalidRefundFee",inputs:[]},{type:"error",name:"MintRecipientNotSet",inputs:[]},{type:"error",name:"Paused",inputs:[]},{type:"error",name:"Unauthorized",inputs:[]},{type:"error",name:"UnauthorizedMsgSender",inputs:[]},{type:"error",name:"UnauthorizedSwapProtocol",inputs:[]}]};import{Buffer as Qa}from"buffer";function Va(e,t,a,r,i){let u=H(Number(r)),s=S(e.fromChain),n=S(e.toChain);if(s!==u)throw new Error(`Signer chain id(${Number(r)}) and quote from chain are not same! ${s} !== ${u}`);let p=A(t,n),o=g(e.redeemRelayerFee,B),c=g(e.gasDrop,Math.min(D(e.toChain),8)),l=BigInt(e.circleMaxFee64),m=BigInt(e.effectiveAmountIn64),y=ne(e.toChain),f;if(a?f=A(a,n):f=A(Tt.programId.toString(),S("solana")),!e.fastMctpMayanContract)throw new Error("FastMctp contract address is missing");let b=e.fastMctpMayanContract;return{tokenIn:e.fastMctpInputContract,amountIn:m,redeemFee:o,gasDrop:c,destAddr:p,destDomain:y,referrerAddr:f,referrerBps:e.referrerBps,payloadType:i?Ft:Ot,customPayload:i?`0x${Qa.from(i).toString("hex")}`:"0x",minFinalityThreshold:Number(e.fastMctpMinFinality),circleMaxFee:l,contractAddress:b}}function vn(e,t,a,r,i){let u=Va(e,t,a,r,i),{contractAddress:s,tokenIn:n,amountIn:p,destAddr:o,redeemFee:c,gasDrop:l,circleMaxFee:m,referrerAddr:y,referrerBps:f,destDomain:b,customPayload:T,minFinalityThreshold:I,payloadType:w}=u,C=new gt(s,ft.abi),k,_;return k=C.interface.encodeFunctionData("bridge",[n,p,c,m,l,o,b,y,f,w,I,T]),_=ye(0),{to:s,data:k,value:_,_params:u}}function ja(e,t,a,r){let i=H(Number(r)),u=S(e.fromChain),s=S(e.toChain);if(u!==i)throw new Error(`Signer chain id(${Number(r)}) and quote from chain are not same! ${u} !== ${i}`);if(!e.fastMctpMayanContract)throw new Error("MCTP contract address is missing");let n=e.fastMctpMayanContract,p=A(t,s),o;a?o=A(a,s):o=A(Tt.programId.toString(),S("solana"));let c=g(e.redeemRelayerFee,B),l=BigInt(e.refundRelayerFee64),m=BigInt(e.circleMaxFee64),y=g(e.gasDrop,Math.min(D(e.toChain),8)),f=ne(e.toChain),b=BigInt(e.effectiveAmountIn64),T=g(e.minAmountOut,Math.min(8,e.toToken.decimals)),I=BigInt(e.deadline64),w=e.toToken.contract===bt?A(Tt.programId.toString(),S("solana")):A(e.toChain==="sui"?e.toToken.verifiedAddress:e.toToken.contract,e.toToken.wChainId);return{tokenIn:e.fastMctpInputContract,amountIn:b,circleMaxFee:m,destDomain:f,minFinalityThreshold:Number(e.fastMctpMinFinality),orderPayload:{payloadType:Dt,destAddr:p,tokenOut:w,amountOutMin:T,gasDrop:y,redeemFee:c,refundFee:l,deadline:I,referrerAddr:o,referrerBps:e.referrerBps||0},contractAddress:n}}function xn(e,t,a,r){let i=ja(e,t,a,r),{contractAddress:u,orderPayload:s,tokenIn:n,amountIn:p,circleMaxFee:o,destDomain:c,minFinalityThreshold:l}=i,y=new gt(u,ft.abi).interface.encodeFunctionData("createOrder",[n,p,o,c,l,s]),f=ye(0);return{to:u,data:y,value:f,_params:i}}function Bn(e,t,a,r,i,u){if(e.type!=="FAST_MCTP")throw new Error("Quote type is not FAST_MCTP");if(!Number.isFinite(Number(r)))throw new Error("Invalid signer chain id");r=Number(r);let s=i||q,n=new gt(d.MAYAN_FORWARDER_CONTRACT,ee.abi);if(e.fromToken.contract===e.fastMctpInputContract)if(e.hasAuction){if(!Number(e.deadline64))throw new Error("Fast Mctp order requires timeout");let p=xn(e,t,a,r),o="forwardERC20",c=[e.fromToken.contract,p._params.amountIn,s,p._params.contractAddress,p.data];return{data:n.interface.encodeFunctionData(o,c),to:d.MAYAN_FORWARDER_CONTRACT,value:ye(0),chainId:r,_forwarder:{method:o,params:c}}}else{let p=vn(e,t,a,r,u),o="forwardERC20",c=[e.fromToken.contract,p._params.amountIn,s,p._params.contractAddress,p.data];return{data:n.interface.encodeFunctionData(o,c),to:d.MAYAN_FORWARDER_CONTRACT,value:ye(0),chainId:r,_forwarder:{method:o,params:c}}}else{let{minMiddleAmount:p,evmSwapRouterAddress:o,evmSwapRouterCalldata:c}=e;if(!p||!o||!c)throw new Error("Fast Mctp swap requires middle amount, router address and calldata");if(e.hasAuction){if(!Number(e.deadline64))throw new Error("Fast Mctp order requires timeout");let l=xn(e,t,a,r),m=g(e.minMiddleAmount,B);if(e.fromToken.contract===bt){let y="swapAndForwardEth",f=[l._params.amountIn,o,c,e.fastMctpInputContract,m,l._params.contractAddress,l.data];return{data:n.interface.encodeFunctionData(y,f),to:d.MAYAN_FORWARDER_CONTRACT,value:ye(l._params.amountIn),chainId:r,_forwarder:{method:y,params:f}}}else{let y="swapAndForwardERC20",f=[e.fromToken.contract,l._params.amountIn,s,o,c,e.fastMctpInputContract,m,l._params.contractAddress,l.data];return{data:n.interface.encodeFunctionData(y,f),to:d.MAYAN_FORWARDER_CONTRACT,value:ye(0),chainId:r,_forwarder:{method:y,params:f}}}}else{let l=vn(e,t,a,r,u),m=g(e.minMiddleAmount,B);if(e.fromToken.contract===bt){let y="swapAndForwardEth",f=[l._params.amountIn,o,c,e.fastMctpInputContract,m,l._params.contractAddress,l.data];return{data:n.interface.encodeFunctionData(y,f),to:d.MAYAN_FORWARDER_CONTRACT,value:ye(l._params.amountIn),chainId:r,_forwarder:{method:y,params:f}}}else{let y="swapAndForwardERC20",f=[e.fromToken.contract,l._params.amountIn,s,o,c,e.fastMctpInputContract,m,l._params.contractAddress,l.data];return{data:n.interface.encodeFunctionData(y,f),to:d.MAYAN_FORWARDER_CONTRACT,value:ye(0),chainId:r,_forwarder:{method:y,params:f}}}}}}function $a(e,t,a,r,i,u){let s=new wt(d.MAYAN_PROGRAM_ID),[n]=wt.findProgramAddressSync([Kn.from("MAIN")],s),p=F(new wt(e.fromToken.mint),n,!0),o=BigInt(e.effectiveAmountIn64),c=A(p.toString(),1),l=A(d.AUCTION_PROGRAM_ID,1),m;a?m=A(a,1):m=A(Ya.programId.toString(),1);let y=H(Number(i)),f=S(e.fromChain),b=S(e.toChain);if(f!==y)throw new Error(`Signer chain id(${Number(i)}) and quote from chain are not same! ${f} !== ${y}`);let T=e.whMayanContract,I={mayanAddr:c,mayanChainId:1,destAddr:A(t,b),destChainId:b,auctionAddr:l,referrer:m,refundAddr:A(r,y)},w=e.toToken.contract===Ln,C={transferDeadline:BigInt(e.deadline64),swapDeadline:BigInt(e.deadline64),amountOutMin:g(e.minAmountOut,Math.min(8,e.toToken.decimals)),gasDrop:g(e.gasDrop,Math.min(8,D(e.toChain))),unwrap:w,customPayload:u?`0x${Kn.from(u).toString("hex")}`:"0x"},k={swapFee:g(e.swapRelayerFee,Math.min(8,e.fromToken.decimals)),redeemFee:g(e.redeemRelayerFee,Math.min(8,e.toToken.decimals)),refundFee:g(e.refundRelayerFee,Math.min(8,e.fromToken.decimals))},_=A(e.toToken.realOriginContractAddress,e.toToken.realOriginChainId),h=g(e.bridgeFee,18);return{amountIn:o,tokenIn:e.fromToken.contract,tokenOut:_,tokenOutWChainId:e.toToken.realOriginChainId,criteria:C,recipient:I,relayerFees:k,contractAddress:T,bridgeFee:h}}function At(e,t,a,r,i,u,s,n){let p=H(Number(u)),o=S(e.fromChain);if(o!==p)throw new Error(`Signer chain id(${Number(u)}) and quote from chain are not same! ${o} !== ${p}`);let c=fe(e,r);if(e.type==="MCTP")return Gt(e,a,c,u,n,s);if(e.type==="SWIFT")return kn(e,t,a,c,u,n);if(e.type==="SHUTTLE")return Dn(e,a,u,n);if(e.type==="FAST_MCTP")return Bn(e,a,c,u,n,s);if(e.type!="WH")throw new Error("Unsupported quote type");if(!Number(e.deadline64))throw new Error("WH mode requires a timeout");let{relayerFees:l,recipient:m,tokenOut:y,tokenOutWChainId:f,criteria:b,tokenIn:T,amountIn:I,contractAddress:w,bridgeFee:C}=$a(e,a,c,i,u,s),k=new Nn(d.MAYAN_FORWARDER_CONTRACT,ee.abi),_=new Nn(w,Wt.abi),h,E,x,L=n||q;if(T===Ln){let P=_.interface.encodeFunctionData("wrapAndSwapETH",[l,m,y,f,b]);h="forwardEth",E=[w,P],x=Wn(I)}else{let P=_.interface.encodeFunctionData("swap",[l,m,y,f,b,T,I]);h="forwardERC20",E=[T,I,L,w,P],x=Wn(C)}let W=k.interface.encodeFunctionData(h,E);return{to:d.MAYAN_FORWARDER_CONTRACT,data:W,value:x,chainId:u,_forwarder:{method:h,params:E}}}async function Ns(e,t,a,r,i,u,s,n){if(!i.provider)throw new Error("No provider found for signer");let p=await i.getAddress();if(p.toLowerCase()!==t.toLowerCase())throw new Error("Signer address does not match swapper address");let o=Number((await i.provider.getNetwork()).chainId);if(e.type==="SWIFT"&&e.gasless){let l=fe(e,r),m=En(e,t,a,l,o,u),y=await i.signTypedData(m.orderTypedData.domain,m.orderTypedData.types,m.orderTypedData.value);return await Bt(m,y),m.orderHash}let c=At(e,t,a,r,p,o,n,u);if(delete c._forwarder,s?.gasPrice&&(c.gasPrice=s.gasPrice),s?.maxFeePerGas&&(c.maxFeePerGas=s.maxFeePerGas),s?.maxPriorityFeePerGas&&(c.maxPriorityFeePerGas=s.maxPriorityFeePerGas),s?.gasLimit)c.gasLimit=s.gasLimit;else{let l=await i.estimateGas(c);c.gasLimit=String(BigInt(String(l))*BigInt(110)/BigInt(100))}return c.chainId=Pt(e.fromChain),i.sendTransaction(c)}async function Ws(e,t,a,r,i){let u=await a.getAddress(),s=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",n=Number((await a.provider.getNetwork()).chainId);if(e.type==="SWIFT"&&e.gasless)return BigInt(0);let p=At(e,t,s,null,u,n,i,r);delete p._forwarder;let o=await a.estimateGas(p);return o=BigInt(String(o)),e.type==="MCTP"||e.type==="SWIFT"?o*BigInt(110)/BigInt(100):o}async function Ks(e,t,a,r){let i="0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",u=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",s=e?.fromToken?.chainId;if(e.type==="SWIFT"&&e.gasless)return BigInt(0);let n=At(e,i,u,null,i,s,r,a);return delete n._forwarder,t.estimateGas(n)}async function Un(e,t){let a;try{a=await t.getMoveFunctionArgTypes({package:e.package,module:e.module,function:e.function})}catch{throw new Error(`Failed to fetch ${e.package}::${e.module}::${e.function} ArgTypes`)}if(a){if(a[e.argumentIndex]!=="Pure"&&a[e.argumentIndex]?.Object!=="ByImmutableReference")throw new Error(`Argument ${e.argumentIndex} of ${e.module}::${e.function} is not immutable`)}else throw new Error(`Failed to fetch package::${e.module}::${e.function} ArgTypes`)}async function It(e,t){let a=[],r=BigInt(0),i;do{let u=await t.getCoins({...e,owner:e.walletAddress,cursor:i}),s=u.data.filter(n=>BigInt(n.balance)>BigInt(0));if(a=[...a,...s],s.forEach(n=>{r+=BigInt(n.balance)}),u.data.length===0||!u.hasNextPage||!u.nextCursor||r>=e.coinAmount)return{coins:a.sort((n,p)=>Number(BigInt(n.coinObjectId)-BigInt(p.coinObjectId))),sum:r};i=u.nextCursor}while(!0)}async function ht(e,t){let a;try{a=await t.getObject({id:e,options:{showContent:!0}})}catch(r){throw new Error(`Failed to fetch Mayan Sui package ID: 

 ${r}`)}if(a.data?.content?.fields?.latest_package_id)return a.data.content.fields.latest_package_id;throw new Error("latest_package_id not found in Mayan Sui state object")}import{Transaction as Re}from"@mysten/sui/transactions";import{SUI_TYPE_ARG as za,SUI_CLOCK_OBJECT_ID as Ja}from"@mysten/sui/utils";import{SystemProgram as Ct}from"@solana/web3.js";import{ZeroAddress as Za}from"ethers";async function Gn(e,t,a,r,i,u,s){let[n,p]=await Promise.all([ht(d.SUI_MCTP_STATE,u),e.hasAuction?ht(d.SUI_MCTP_FEE_MANAGER_STATE,u):null]),o=g(e.minMiddleAmount,B),c,l,m;if(e.fromToken.contract===e.mctpInputContract)c=s?.builtTransaction??new Re,l=await Ze(o,t,e.mctpInputContract,u,c,s?.inputCoin);else{let{tx:b,outCoin:T,whFeeCoin:I}=await xt({amountIn64:e.effectiveAmountIn64,inputCoinType:e.fromToken.contract,middleCoinType:e.mctpInputContract,userWallet:t,withWhFee:e.hasAuction||e.cheaperChain!=="sui",referrerAddress:r,inputCoin:s?.inputCoin,transaction:s?.builtTransaction?await s.builtTransaction.toJSON():void 0});c=Re.from(b),l=T,m=I?{result:I}:null}e.hasAuction?await er(e,t,a,r,n,p,u,{inputCoin:{result:l},whFeeCoin:m,builtTransaction:c}):e.cheaperChain==="sui"?await qa(e,t,a,n,u,{inputCoin:{result:l},whFeeCoin:m,builtTransaction:c}):await Xa(e,t,a,n,i,u,{inputCoin:{result:l},whFeeCoin:m,builtTransaction:c});let y=BigInt(e.effectiveAmountIn64),f=i?Uint8Array.from(i):Uint8Array.from([]);c.moveCall({package:n,module:"init_order",function:"log_initialize_mctp",typeArguments:[e.fromToken.contract],arguments:[c.pure.u64(y),c.object(e.fromToken.verifiedAddress),c.pure.vector("u8",f)]});try{let b;r?b=A(r,S(e.toChain)):b=A(Ct.programId.toString(),S("solana")),c.moveCall({package:d.SUI_LOGGER_PACKAGE_ID,module:"referrer_logger",function:"log_referrer",arguments:[c.pure.address(b),c.pure.u8(e.referrerBps||0)]})}catch(b){console.error("Failed to log referrer",b)}return c}async function Xa(e,t,a,r,i,u,s){let n=S(e.toChain),p=s?.builtTransaction??new Re,o=g(e.minMiddleAmount,B),c=await Ze(o,t,e.mctpInputContract,u,p,s?.inputCoin),l=i?ve:De,m=A(a,n),y=ne(e.toChain),f=g(e.gasDrop,Math.min(D(e.toChain),8)),b=g(e.redeemRelayerFee,B),T=i?Uint8Array.from(i):Uint8Array.from([]),[I]=p.moveCall({package:r,module:"bridge_with_fee",function:"prepare_bridge_with_fee",typeArguments:[e.mctpInputContract],arguments:[p.pure.u8(l),c,p.pure.u64(o),p.pure.address(m),p.pure.u32(y),p.pure.u64(f),p.pure.u64(b),p.pure.vector("u8",T)]}),[w,C]=p.moveCall({package:r,module:"bridge_with_fee",function:"bridge_with_fee",typeArguments:[e.mctpInputContract],arguments:[p.object(d.SUI_MCTP_STATE),p.object(d.SUI_CCTP_CORE_STATE),p.object(e.mctpVerifiedInputAddress),I]}),[k,_]=p.moveCall({package:d.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${r}::bridge_with_fee::CircleAuth`],arguments:[C,p.object(d.SUI_CCTP_TOKEN_STATE),p.object(d.SUI_CCTP_CORE_STATE),p.object("0x403"),p.object(e.mctpInputTreasury)]}),[h]=p.moveCall({package:r,module:"bridge_with_fee",function:"publish_bridge_with_fee",arguments:[p.object(d.SUI_MCTP_STATE),w,_]});return await Hn(p,h,u,BigInt(e.bridgeFee),t,s?.whFeeCoin),p}async function qa(e,t,a,r,i,u){let s=S(e.toChain),n=u?.builtTransaction??new Re,p=g(e.minMiddleAmount,B),o=await Ze(p,t,e.mctpInputContract,i,n,u?.inputCoin),c=A(a,s),l=ne(e.toChain),m=g(e.gasDrop,Math.min(D(e.toChain),8)),y=g(e.redeemRelayerFee,B),[f]=n.moveCall({package:r,module:"bridge_locked_fee",function:"prepare_bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[o,n.pure.u64(p),n.pure.address(c),n.pure.u32(l),n.pure.u64(m),n.pure.u64(y)]}),[b,T]=n.moveCall({package:r,module:"bridge_locked_fee",function:"bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[n.object(d.SUI_MCTP_STATE),n.object(d.SUI_CCTP_CORE_STATE),n.object(e.mctpVerifiedInputAddress),f]}),[I,w]=n.moveCall({package:d.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${r}::bridge_locked_fee::CircleAuth`],arguments:[T,n.object(d.SUI_CCTP_TOKEN_STATE),n.object(d.SUI_CCTP_CORE_STATE),n.object("0x403"),n.object(e.mctpInputTreasury)]});return n.moveCall({package:r,module:"bridge_locked_fee",function:"store_bridge_locked_fee",typeArguments:[e.mctpInputContract],arguments:[n.object(d.SUI_MCTP_STATE),n.object(e.mctpVerifiedInputAddress),b,w]}),n}async function er(e,t,a,r,i,u,s,n){let p=S(e.toChain),o=n?.builtTransaction??new Re,c=g(e.minMiddleAmount,B),[l]=await Promise.all([Ze(c,t,e.mctpInputContract,s,o,n?.inputCoin),Un({package:u,module:"calculate_mctp_fee",function:"prepare_calc_mctp_fee",argumentIndex:3},s)]),m=e.toToken.contract===Za?A(Ct.programId.toString(),S("solana")):A(e.toToken.contract,e.toToken.wChainId),y=g(e.minAmountOut,Math.min(8,e.toToken.decimals)),f=A(a,p),b=ne(e.toChain),T=g(e.gasDrop,Math.min(D(e.toChain),8)),I=g(e.redeemRelayerFee,B),w=BigInt(e.deadline64),C;r?C=A(r,p):C=A(Ct.programId.toString(),S("solana"));let k=[o.object(e.mctpVerifiedInputAddress),o.pure.u8(Rt),o.pure.address(t),l,o.pure.address(f),o.pure.u16(p),o.pure.address(m),o.pure.u64(y),o.pure.u64(T),o.pure.u64(I),o.pure.u64(w),o.pure.address(C),o.pure.u8(e.referrerBps)],[_]=o.moveCall({package:u,module:"calculate_mctp_fee",function:"prepare_calc_mctp_fee",typeArguments:[e.mctpInputContract],arguments:k}),[h]=o.moveCall({package:u,module:"calculate_mctp_fee",function:"calculate_mctp_fee",arguments:[o.object(d.SUI_MCTP_FEE_MANAGER_STATE),_]}),[E]=o.moveCall({package:i,module:"init_order",function:"prepare_initialize_order",typeArguments:[e.mctpInputContract],arguments:[...k.slice(1),o.pure.u32(b),o.pure.u64(c)]}),[x,L]=o.moveCall({package:i,module:"init_order",function:"initialize_order",typeArguments:[e.mctpInputContract],arguments:[o.object(d.SUI_MCTP_STATE),o.object(d.SUI_CCTP_CORE_STATE),o.object(e.mctpVerifiedInputAddress),E,h]}),[W,P]=o.moveCall({package:d.SUI_CCTP_TOKEN_PACKAGE_ID,module:"deposit_for_burn",function:"deposit_for_burn_with_caller_with_package_auth",typeArguments:[e.mctpInputContract,`${i}::init_order::CircleAuth`],arguments:[L,o.object(d.SUI_CCTP_TOKEN_STATE),o.object(d.SUI_CCTP_CORE_STATE),o.object("0x403"),o.object(e.mctpInputTreasury)]}),[O]=o.moveCall({package:i,module:"init_order",function:"publish_init_order",arguments:[o.object(d.SUI_MCTP_STATE),x,P]});return await Hn(o,O,s,BigInt(e.bridgeFee),t,n?.whFeeCoin),o}async function Hn(e,t,a,r,i,u){let s;if(u?.result)s=u.result;else if(u?.objectId)s=e.object(u.objectId);else if(r>BigInt(0)){let{coins:n,sum:p}=await It({walletAddress:i,coinType:za,coinAmount:r},a);if(p<r)throw new Error("Insufficient funds to pay Wormhole message fee");n.length>1&&e.mergeCoins(n[0].coinObjectId,n.slice(1).map(c=>c.coinObjectId));let[o]=e.splitCoins(n[0].coinObjectId,[r]);s=o}else{let[n]=e.splitCoins(e.gas,[e.pure.u64(0)]);s=n}return e.moveCall({package:d.SUI_WORMHOLE_PACKAGE_ID,module:"publish_message",function:"publish_message",arguments:[e.object(d.SUI_WORMHOLE_STATE),s,t,e.object(Ja)]}),e}async function Ze(e,t,a,r,i,u){let s;if(u?.result)s=u.result;else if(u?.objectId)s=i.object(u.objectId);else{let{coins:n,sum:p}=await It({walletAddress:t,coinType:a,coinAmount:e},r);if(p<e)throw new Error(`Insufficient funds to create Coin ${a} with amount ${e}`);n.length>1&&i.mergeCoins(n[0].coinObjectId,n.slice(1).map(c=>c.coinObjectId));let[o]=i.splitCoins(n[0].coinObjectId,[e]);s=o}return s}async function io(e,t,a,r,i,u,s){let n=fe(e,r);if(e.type==="MCTP")return Gn(e,t,a,n,i,u,s);throw new Error("Unsupported quote type from Sui chain")}export{Ft as FAST_MCTP_PAYLOAD_TYPE_CUSTOM_PAYLOAD,Ot as FAST_MCTP_PAYLOAD_TYPE_DEFAULT,Dt as FAST_MCTP_PAYLOAD_TYPE_ORDER,Rt as MCTP_INIT_ORDER_PAYLOAD_ID,ve as MCTP_PAYLOAD_TYPE_CUSTOM_PAYLOAD,De as MCTP_PAYLOAD_TYPE_DEFAULT,q as ZeroPermit,qa as addBridgeLockedFeeMoveCalls,Xa as addBridgeWithFeeMoveCalls,er as addInitOrderMoveCalls,d as addresses,Un as assertArgumentIsImmutable,nn as broadcastJitoBundleId,kt as checkSdkVersionSupport,tn as confirmJitoBundleId,Xt as createApproveInstruction,Y as createAssociatedTokenAccountInstruction,Ta as createCloseAccountInstruction,Ge as createInitializeRandomTokenAccountInstructions,bn as createMctpFromSolanaInstructions,Gn as createMctpFromSuiMoveCalls,_e as createSplTransferInstruction,Ka as createSwapFromSolanaInstructions,io as createSwapFromSuiMoveCalls,wn as createSwiftFromSolanaInstructions,ct as createSwiftOrderHash,Me as createSyncNativeInstruction,Ve as createTransferAllAndCloseInstruction,Qe as decentralizeClientSwapInstructions,qt as decideRelayer,Ne as deserializeInstructionInfo,Ws as estimateQuoteRequiredGas,Ks as estimateQuoteRequiredGasAprox,It as fetchAllCoins,dr as fetchAllTokenList,ht as fetchMayanSuiPackageId,yr as fetchQuote,mr as fetchTokenList,oa as generateFetchQuoteUrl,He as getAddressLookupTableAccounts,g as getAmountOfFractionalAmount,Z as getAnchorInstructionData,F as getAssociatedTokenAddress,fr as getCurrentChainTime,or as getDisplayAmount,Pt as getEvmChainIdByName,D as getGasDecimal,Et as getGasDecimalsInSolana,en as getJitoTipTransfer,Gt as getMctpFromEvmTxPayload,fe as getQuoteSuitableReferrerAddress,R as getSafeU64Blob,Oe as getSdkVersion,vt as getSuggestedRelayer,At as getSwapFromEvmTxPayload,xe as getSwapSolana,xt as getSwapSui,H as getWormholeChainIdById,S as getWormholeChainIdByName,K as hexToUint8Array,ia as isValidAptosType,A as nativeAddressToHexString,ut as sendJitoBundle,se as solMint,Bt as submitSwiftEvmSwap,Nt as submitSwiftSolanaSwap,Ue as submitTransactionWithRetry,Ns as swapFromEvm,Wi as swapFromSolana,Yr as unwrapSol,Pe as validateJupSwap,Fe as wait,jr as wrapSol};
